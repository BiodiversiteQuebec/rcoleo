<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> • rcoleo</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="">
<meta property="og:description" content="rcoleo">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rcoleo</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://coleo.biodiversite-quebec.ca/docs/">
    <span class="fa fa-book fa-lg"></span>
     
  </a>
</li>
<li>
  <a></a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/telecharge-sites.html">Téléchargement des sites</a>
    </li>
    <li>
      <a href="../articles/injection-cellules.html">Injection des cellules</a>
    </li>
    <li>
      <a href="../articles/injection-taxa.html">Injection des noms d'espèce</a>
    </li>
    <li>
      <a href="../articles/injection-sites.html">Injecter sites</a>
    </li>
    <li>
      <a href="../articles/CAMPAGNE_zooplancton_injection.html">Injection des campagnes ZOOPLANCTON</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ReseauBiodiversiteQuebec/rcoleo">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="injection-cellules_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip></h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ReseauBiodiversiteQuebec/rcoleo/blob/master/vignettes/injection-cellules.Rmd"><code>vignettes/injection-cellules.Rmd</code></a></small>
      <div class="hidden name"><code>injection-cellules.Rmd</code></div>

    </div>

    
    
<div id="préparation-des-données" class="section level2">
<h2 class="hasAnchor">
<a href="#pr%C3%A9paration-des-donn%C3%A9es" class="anchor"></a>1. Préparation des données</h2>
<p>Les informations concernant les cellules sont regroupées dans un fichier de type shapefile. Les informations essentielles à l’insertion de nouvelles cellules dans Coléo sont les suivantes :</p>
<ul>
<li>
<strong>name</strong> : nom de la cellule</li>
<li>
<strong>cell_code</strong> : obligatoire - code numérique unique pour chaque cellule</li>
<li>
<strong>geom</strong> : obligatoire - coordonnées de la cellule</li>
</ul>
</div>
<div id="créer-un-projet-r" class="section level2">
<h2 class="hasAnchor">
<a href="#cr%C3%A9er-un-projet-r" class="anchor"></a>2. Créer un projet R</h2>
<p>Dans RStudio,</p>
<ul>
<li>Aller dans File &gt; New Project &gt; New Directory &gt; New Project</li>
<li>Choisir un nom de projet et un lieu dans les fichiers pour le projet</li>
</ul>
<p>Les projets permettent de travailler dans un répertoire de travail. Le fichiers shapefile (et autres fichiers associés) doit donc être sauvegardée dans le même dossier que le projet afin de faire parti du répertoire de travail.</p>
</div>
<div id="installer-les-packages-nécessaires" class="section level2">
<h2 class="hasAnchor">
<a href="#installer-les-packages-n%C3%A9cessaires" class="anchor"></a>3. Installer les packages nécessaires</h2>
<p>Dans RStudio,</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"dplyr"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"rgdal"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"sp"</span><span class="op">)</span></code></pre></div>
<p>pour installer le package rcoleo, il faut utiliser le packages devtools, il faut donc l’appeller avec library()</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">devtools</span><span class="op">)</span>
<span class="co"># Installation du package rcoleo à partir de github</span>
<span class="fu">install_github</span><span class="op">(</span><span class="st">"RéseauBiodiversiteQuebec/rcoleo"</span><span class="op">)</span> </code></pre></div>
</div>
<div id="mettre-en-cache-son-jeton-daccès" class="section level2">
<h2 class="hasAnchor">
<a href="#mettre-en-cache-son-jeton-dacc%C3%A8s" class="anchor"></a>4. Mettre en cache son jeton d’accès</h2>
<p>Ce jeton permet d’apporter des modifications dans Coléo. Il est unique et se retrouve dans Coléo, sous le profil de l’utilisateur dans le menu à gauche.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="st">"votrejeton"</span>, <span class="st">".httr-oauth"</span><span class="op">)</span></code></pre></div>
<p>Cette étape n’est faite qu’une fois et permet l’enregistrement de votre jeton dans le répertoire du projet R. Une fois faite, elle est supprimée du code d’injection. Le jeton est confidentiel.</p>
</div>
<div id="injection-des-cellules-dans-coléo" class="section level2">
<h2 class="hasAnchor">
<a href="#injection-des-cellules-dans-col%C3%A9o" class="anchor"></a>5. Injection des cellules dans Coléo</h2>
<ul>
<li>
<strong>5.1</strong> Cette étape appelle les packages installés afin qu’ils puissent être utilisés</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ReseauBiodiversiteQuebec/rcoleo">rcoleo</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: package 'dplyr' was built under R version 4.0.2</code></pre>
<ul>
<li>
<strong>5.2</strong> L’étape suivante permet de créer un vecteur avec le code des cellules à ajouter à Coléo</li>
</ul>
<p>Vous avez deux possibilités pour compléter cette étape:</p>
<ul>
<li>Entrer manuellement le code des cellules dans un objet R.</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Codes des nouvelles cellules à insérer</span>
<span class="va">cell_code</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"124_93"</span>, <span class="st">"73_137"</span><span class="op">)</span></code></pre></div>
<ul>
<li>Utiliser l’objet créer lors de l’utilisation de la fonction <code><a href="../reference/COLEO_comp.html">COLEO_comp()</a></code> si vous êtes dans le cadre d’une insertion de nouvelles campagnes.</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cell_code</span> <span class="op">&lt;-</span> <span class="va">cell_manquante</span> <span class="co"># Codes des nouvelles cellules à insérer</span></code></pre></div>
<ul>
<li>
<strong>5.3</strong> Cette étape permet d’enregistrer un objet dans R avec les informations de toutes les cellules existantes</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">shp_cells</span> <span class="op">&lt;-</span> <span class="fu">rgdal</span><span class="fu">::</span><span class="fu">readOGR</span><span class="op">(</span>dsn<span class="op">=</span><span class="st">"./shp"</span>,
                            layer<span class="op">=</span><span class="st">"Cellule_terrain_2016-2020"</span><span class="op">)</span> <span class="co"># Ici le fichier shapefile est placé dans un dossier shp et on appelle tous les fichiers nommés "Cellule_terrain_2016_2020"</span></code></pre></div>
<ul>
<li>
<strong>5.4</strong> Cette étape permet d’extraire les informations nécessaires concernant les nouvelles cellules et de formater ces informations de sorte à pouvoir les insérer dans Coléo.</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Création d'une liste vide pour l'objet final</span>
<span class="va">shp_cells_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">cell_code</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  
<span class="co"># Obtention des information pour un cellule</span>
  <span class="va">shp</span> <span class="op">&lt;-</span> <span class="va">shp_cells</span><span class="op">[</span><span class="va">shp_cells</span><span class="op">$</span><span class="va">IJ</span> <span class="op">==</span> <span class="va">cell_code</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> ,<span class="op">]</span> 
  
<span class="co"># Création d'une liste avec les informations nécessaires pour chaque cellule</span>
  <span class="va">cells_ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
  <span class="va">cells_ls</span><span class="op">$</span><span class="va">cell_code</span> <span class="op">&lt;-</span> <span class="va">cell_code</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="co"># Code de la cellule</span>
  <span class="va">cells_ls</span><span class="op">$</span><span class="va">name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">shp_cells</span><span class="op">[</span><span class="va">shp_cells</span><span class="op">$</span><span class="va">IJ</span> <span class="op">==</span> <span class="va">cell_code</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">shp_cells</span><span class="op">$</span><span class="va">Nom</span><span class="op">)</span>,<span class="op">]</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">Nom</span><span class="op">)</span> <span class="co"># Nom de la cellule</span>
  
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">cells_ls</span><span class="op">$</span><span class="va">name</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html">character</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">cells_ls</span><span class="op">$</span><span class="va">name</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
  <span class="op">}</span> <span class="co"># Information absente si pas de nom pour la cellule</span>
  
<span class="co"># Création de l'objet spatial pour les coordonnées de la cellule</span>
  <span class="va">shp_sp</span> <span class="op">&lt;-</span> <span class="fu">as</span><span class="op">(</span><span class="va">shp</span>, <span class="st">"SpatialPolygons"</span><span class="op">)</span>
  <span class="va">cells_ls</span><span class="op">$</span><span class="va">geom</span> <span class="op">&lt;-</span> <span class="fu">geojsonio</span><span class="fu">::</span><span class="fu">geojson_list</span><span class="op">(</span><span class="va">shp</span><span class="op">)</span><span class="op">$</span><span class="va">features</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">geometry</span> <span class="co"># Caractéristiques de l'objet spatial</span>
  <span class="va">cells_ls</span><span class="op">$</span><span class="va">geom</span><span class="op">$</span><span class="va">crs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"name"</span>,properties<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"EPSG:4326"</span><span class="op">)</span><span class="op">)</span> <span class="co"># Information sur le systême de coordonnées de référence (CRS)</span>

<span class="co"># Alimentation de l'objet final avec un niveau pour chaque cellule</span>
  <span class="va">shp_cells_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">cells_ls</span> 
<span class="op">}</span></code></pre></div>
<ul>
<li>
<strong>5.5</strong> Nous pouvons maintenant insérer les nouvelles cellules dans la base de données Coléo.</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Envoyer la nouvelle cellule vers Coléo</span>
<span class="va">resp_cells</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/post_cells.html">post_cells</a></span><span class="op">(</span><span class="va">shp_cells_list</span><span class="op">)</span></code></pre></div>
<p>Bravo ! Vous venez d’injecter vos nouvelles cellules dans la base de données Coléo.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Steve Vissault.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'API_KEY',
    indexName: 'INDEX_NAME',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
