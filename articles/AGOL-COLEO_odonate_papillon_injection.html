<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tutoriel injections AGOL vers COLEO • rcoleo</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Tutoriel injections AGOL vers COLEO">
<meta property="og:description" content="rcoleo">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rcoleo</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://coleo.biodiversite-quebec.ca/docs/" class="external-link">
    <span class="fas fa-book fa-lg"></span>
     
  </a>
</li>
<li>
  <a></a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/telecharge-sites.html">Téléchargement des sites</a>
    </li>
    <li>
      <a href="../articles/injection-cellules.html">Injection des cellules</a>
    </li>
    <li>
      <a href="../articles/injection-taxa.html">Injection des noms d'espèce</a>
    </li>
    <li>
      <a href="../articles/injection-sites.html">Injection des sites</a>
    </li>
    <li>
      <a href="../articles/CAMPAGNE_zooplancton_injection.html">Injection des campagnes ZOOPLANCTON</a>
    </li>
    <li>
      <a href="../articles/CAMPAGNE_papillon_injection.html">Injection des campagnes PAPILONIDÉS</a>
    </li>
    <li>
      <a href="../articles/CAMPAGNE_odonate_injection.html">Injection des campagnes ODONATES</a>
    </li>
    <li>
      <a href="../articles/CAMPAGNE_insects_sol_injection.html">Injection des campagnes INSECTES SOL</a>
    </li>
    <li>
      <a href="../articles/AGOL-COLEO_odonate_papillon_injection.html">Injection ODONATES et PAPILIONIDÉS AGOL-COLEO</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ReseauBiodiversiteQuebec/rcoleo" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="AGOL-COLEO_odonate_papillon_injection_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Tutoriel injections AGOL vers COLEO</h1>
                        <h4 data-toc-skip class="author">Claire-Cécile Juhasz</h4>
            
            <h4 data-toc-skip class="date">23 décembre 2020</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ReseauBiodiversiteQuebec/rcoleo/blob/master/vignettes/AGOL-COLEO_odonate_papillon_injection.Rmd" class="external-link"><code>vignettes/AGOL-COLEO_odonate_papillon_injection.Rmd</code></a></small>
      <div class="hidden name"><code>AGOL-COLEO_odonate_papillon_injection.Rmd</code></div>

    </div>

    
    
<style>
div.red { background-color:#ff0000; border-radius: 8px; padding: 5px;}
</style>
<style>
div.blue { background-color:#e6f0ff; border-radius: 8px; padding: 5px;}
</style>
<div class="red">
<p>Vignette en cours de développement</p>
</div>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Conversion des données extraites des formulaires de AGOL pour injection dans COLEO</span>
<span class="co"># Formulaires utilisés: papillon/odonate</span>
<span class="co"># Données des formulaires de AGOL extraites sous la forme de 4 fichiers connectés entre eux via GlobalID/ParentGlobalID</span>
<span class="co"># Odonate_X_Papillon_0.csv pour les sites utilisés</span>
<span class="co"># invetaire_1.csv pour le détails des espèces observées sur le terrain</span>
<span class="co"># identification_2.csv pour l'identification post terrain, enlabo</span>
<span class="co"># photo_s_3.csv pour les medias</span>

<span class="co"># Chargement &amp; nettoyage du fichier sur les campagnes utiles</span>
<span class="va">camp_0</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_delim</a></span><span class="op">(</span><span class="st">"./AGOL_data_2/Odonate_X_Papillon_0.csv"</span>, delim <span class="op">=</span> <span class="st">";"</span><span class="op">)</span>
<span class="va">camp_0</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">camp_0</span>,
                 <span class="va">GlobalID</span>,
                 <span class="va">date</span>,
                 <span class="va">labo</span>,
                 <span class="va">lon</span>,
                 <span class="va">lat</span>,
                 <span class="va">cell_code</span>,
                 <span class="va">id</span>,
                 <span class="va">cell_code_FS</span>,
                 <span class="va">site_code</span>,
                 <span class="va">site_code_FS</span>,
                 <span class="va">type_hab</span>,
                 <span class="va">type_hab_FS</span>,
                 <span class="va">time_start</span>,
                 <span class="va">technicien_1</span>,
                 <span class="va">technicien_1_FS</span>,
                 <span class="va">temp_c</span>,
                 <span class="va">sky</span>,
                 <span class="va">wind</span>,
                 <span class="va">time_finish</span>,
                 <span class="va">note</span><span class="op">)</span>

<span class="co"># Chargement &amp; nettoyage du fichier inventaire</span>
<span class="va">inv_1</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_delim</a></span><span class="op">(</span><span class="st">"./AGOL_data_2/inventaire_1.csv"</span>, delim <span class="op">=</span> <span class="st">";"</span><span class="op">)</span>
<span class="va">inv_1</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">inv_1</span>,
                       <span class="va">capture_ou_vu</span>,
                       <span class="va">o_or_p</span>,
                       <span class="va">no_seq_ind_cap</span>,
                       <span class="va">taxa_name_p</span>,
                       <span class="va">taxa_name_p_FS</span>,
                       <span class="va">abondance_cap</span>,
                       <span class="va">rank_cap</span>,
                       <span class="va">category_cap</span>,
                       <span class="va">vernacular_fr_cap</span>,
                       <span class="va">ParentGlobalID</span><span class="op">)</span>

<span class="co"># Chargement &amp; nettoyage du fichier identifications au labo</span>
<span class="va">id_2</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_delim</a></span><span class="op">(</span><span class="st">"./AGOL_data_2/identification_2.csv"</span>, delim <span class="op">=</span> <span class="st">";"</span><span class="op">)</span>
<span class="va">id_2</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id_2</span>,
                      o_or_p_labo <span class="op">=</span> <span class="va">p_or_o</span>,
                      <span class="va">no_seq_ind_labo</span>,
                      <span class="va">odonate</span>,
                      <span class="va">papillon</span>,
                      <span class="va">o_p_FS</span>,
                      <span class="va">abondance_labo</span>,
                      <span class="va">rank_labo</span>,
                      <span class="va">vernacular_fr_labo</span>,
                      <span class="va">category_labo</span><span class="op">)</span>

<span class="co"># Fusion des fichiers AGOL</span>
<span class="va">data1</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">inv_1</span>,
                          <span class="va">camp_0</span>,
                          by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ParentGlobalID"</span> <span class="op">=</span> <span class="st">"GlobalID"</span><span class="op">)</span><span class="op">)</span>
<span class="va">data2</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">data1</span>,
                          <span class="va">id_2</span>,
                          by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"no_seq_ind_cap"</span> <span class="op">=</span> <span class="st">"no_seq_ind_labo"</span><span class="op">)</span><span class="op">)</span>
<span class="va">data2</span><span class="op">$</span><span class="va">num</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>

<span class="co">#### Etape 1 - Verifier que les colones "xxx_FS" soient vides ####</span>
<span class="va">fs</span> <span class="op">&lt;-</span> <span class="va">data2</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"FS"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="co"># Recuperation des colonnes "freestyle"</span>

<span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">fs</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">{</span> <span class="co"># Debut de boucle pour verifier les entrées de ces colonnes</span>
  <span class="va">nom</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">fs</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">{</span>
    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">fs</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span>
      <span class="va">nom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">nom</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">fs</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Vérifiez les colonnes suivantes de vos données (ne doit contenir que des NA) :"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">nom</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">" "</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>



<span class="co">#### Etape 2 - Verifier l'orthographe des types d'habitat et de campagnes - entree limitee dans coleo ####</span>
<span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">data2</span><span class="op">$</span><span class="va">type_hab</span><span class="op">)</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'lac'</span>, <span class="st">'rivière'</span>, <span class="st">'forestier'</span>, <span class="st">'marais'</span>, <span class="st">'marais côtier'</span>, <span class="st">'toundrique'</span>, <span class="st">'tourbière'</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Vérifiez que le choix du type d'habitat soit contenu dans la liste suivante : 'lac', 'rivière', 'forestier', 'marais', 'marais côtier', 'toundrique', 'tourbière'"</span><span class="op">)</span>
<span class="op">}</span>

<span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">data2</span><span class="op">$</span><span class="va">o_or_p</span><span class="op">)</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"odonates"</span>, <span class="st">"papilionidés"</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Vérifiez que le choix du type d'habitat soit contenu dans la liste suivante : 'odonates', 'papilionidés'"</span><span class="op">)</span>
<span class="op">}</span>

<span class="co">#### Etape 3 - Verifier que le code des cellules correspondent aux codes des sites ####</span>
<span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">data2</span><span class="op">$</span><span class="va">cell_code</span> <span class="op">==</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html" class="external-link">str_sub</a></span><span class="op">(</span><span class="va">data2</span><span class="op">$</span><span class="va">site_code</span>, <span class="fl">1</span>, <span class="op">-</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Vérifier que le code des cellules correspondent au code des sites et vice versa"</span><span class="op">)</span>
<span class="op">}</span>

<span class="co">#### Etape 4 - Formater les dates - Passer de mm/dd/YYYY hh:mm:ss AM/PM a YYYY-mm-dd ####</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">tidyr</span><span class="op">)</span>
<span class="va">data2</span><span class="op">$</span><span class="va">date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">data2</span><span class="op">$</span><span class="va">date</span><span class="op">)</span>
<span class="va">data2</span><span class="op">$</span><span class="va">date</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html" class="external-link">str_sub</a></span><span class="op">(</span><span class="va">data2</span><span class="op">$</span><span class="va">date</span>, <span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span>

<span class="va">data2</span> <span class="op">&lt;-</span> <span class="va">data2</span> <span class="op">%&gt;%</span> 
  <span class="fu">separate</span><span class="op">(</span><span class="va">date</span>,
           into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mm"</span>, <span class="st">"dd"</span>, <span class="st">"YYYY"</span><span class="op">)</span>,
           sep <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span>
<span class="va">data2</span><span class="op">$</span><span class="va">opened_at</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">data2</span><span class="op">$</span><span class="va">YYYY</span>, <span class="va">data2</span><span class="op">$</span><span class="va">mm</span>, <span class="va">data2</span><span class="op">$</span><span class="va">dd</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span>

<span class="co">#### Etape 5 - Formater données en vue de l'injection dans coleo ####</span>

<span class="va">campaign</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>

<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">data2</span><span class="op">$</span><span class="va">capture_ou_vu</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">==</span> <span class="st">"capture"</span><span class="op">)</span><span class="op">{</span>
    
    <span class="va">num</span> <span class="op">&lt;-</span> <span class="va">data2</span><span class="op">$</span><span class="va">num</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
    <span class="va">abondance</span> <span class="op">&lt;-</span> <span class="va">data2</span><span class="op">$</span><span class="va">abondance_labo</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
    <span class="va">rank</span> <span class="op">&lt;-</span> <span class="va">data2</span><span class="op">$</span><span class="va">rank_labo</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
    <span class="va">category</span> <span class="op">&lt;-</span> <span class="va">data2</span><span class="op">$</span><span class="va">category_labo</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
    <span class="va">type</span> <span class="op">&lt;-</span> <span class="va">data2</span><span class="op">$</span><span class="va">o_or_p_labo</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
    
    <span class="kw">if</span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"odonates"</span><span class="op">)</span><span class="op">{</span>
      
      <span class="va">taxa_name</span> <span class="op">&lt;-</span> <span class="va">data2</span><span class="op">$</span><span class="va">odonate</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
      <span class="va">vernacular_fr</span> <span class="op">&lt;-</span> <span class="va">data2</span><span class="op">$</span><span class="va">vernacular_fr_labo</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
      
    <span class="op">}</span><span class="kw">else</span><span class="op">{</span>
      <span class="va">taxa_name</span> <span class="op">&lt;-</span> <span class="va">data2</span><span class="op">$</span><span class="va">papillon</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>  
    <span class="op">}</span>
    <span class="va">row_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">num</span>, <span class="va">type</span>, <span class="va">taxa_name</span>, <span class="va">vernacular_fr</span>, <span class="va">rank</span>, <span class="va">category</span>, <span class="va">abondance</span><span class="op">)</span>
    <span class="va">campaign</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">campaign</span>, <span class="va">row_df</span><span class="op">)</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
    
    <span class="va">num</span> <span class="op">&lt;-</span> <span class="va">data2</span><span class="op">$</span><span class="va">num</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
    <span class="va">abondance</span> <span class="op">&lt;-</span> <span class="va">data2</span><span class="op">$</span><span class="va">abondance_cap</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
    <span class="va">rank</span> <span class="op">&lt;-</span> <span class="va">data2</span><span class="op">$</span><span class="va">rank_cap</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
    <span class="va">category</span> <span class="op">&lt;-</span> <span class="va">data2</span><span class="op">$</span><span class="va">category_cap</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
    <span class="va">type</span> <span class="op">&lt;-</span> <span class="va">data2</span><span class="op">$</span><span class="va">o_or_p</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
    <span class="va">taxa_name</span> <span class="op">&lt;-</span> <span class="va">data2</span><span class="op">$</span><span class="va">taxa_name_p</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
    <span class="va">vernacular_fr</span> <span class="op">&lt;-</span> <span class="va">data2</span><span class="op">$</span><span class="va">vernacular_fr_cap</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
    
    <span class="va">row_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">num</span>, <span class="va">type</span>, <span class="va">taxa_name</span>, <span class="va">vernacular_fr</span>, <span class="va">rank</span>, <span class="va">category</span>, <span class="va">abondance</span><span class="op">)</span>
    <span class="va">campaign</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">campaign</span>, <span class="va">row_df</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span>

<span class="co"># Fusion </span>
<span class="va">campaign</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">campaign</span>,
                         <span class="va">data2</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"num"</span>,
                                  <span class="st">"cell_code"</span>,
                                  <span class="st">"site_code"</span>,
                                  <span class="st">"type_hab"</span>,
                                  <span class="st">"lat"</span>,
                                  <span class="st">"lon"</span>,
                                  <span class="st">"opened_at"</span>,
                                  <span class="st">"technicien_1"</span>,
                                  <span class="st">"time_start"</span>,
                                  <span class="st">"time_finish"</span>,
                                  <span class="st">"temp_c"</span>,
                                  <span class="st">"sky"</span>,
                                  <span class="st">"wind"</span>,
                                  <span class="st">"note"</span><span class="op">)</span><span class="op">]</span>,
                         by <span class="op">=</span> <span class="st">"num"</span><span class="op">)</span>
<span class="va">campaign</span><span class="op">$</span><span class="va">closed_at</span> <span class="op">&lt;-</span> <span class="va">campaign</span><span class="op">$</span><span class="va">opened_at</span>

<span class="co"># Gestion des heures</span>
<span class="va">campaign</span><span class="op">$</span><span class="va">time_finish</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html" class="external-link">str_sub</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">campaign</span><span class="op">$</span><span class="va">time_finish</span><span class="op">)</span>, <span class="fl">1</span>, <span class="op">-</span><span class="fl">4</span><span class="op">)</span>
<span class="va">campaign</span><span class="op">$</span><span class="va">time_start</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html" class="external-link">str_sub</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">campaign</span><span class="op">$</span><span class="va">time_start</span><span class="op">)</span>, <span class="fl">1</span>, <span class="op">-</span><span class="fl">4</span><span class="op">)</span>

<span class="co"># Gestion de la liste des tech</span>
<span class="va">tech</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html" class="external-link">str_split</a></span><span class="op">(</span><span class="va">campaign</span><span class="op">$</span><span class="va">technicien_1</span>, <span class="st">","</span><span class="op">)</span>

<span class="va">tech</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">tech</span>, <span class="va">as.list</span><span class="op">)</span>
<span class="va">campaign</span><span class="op">$</span><span class="va">technicien_1</span> <span class="op">&lt;-</span> <span class="va">tech</span>

<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">campaign</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">campaign</span><span class="op">)</span> <span class="op">==</span> <span class="st">"technicien_1"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"technicians"</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#### Etape 6 - Verifier si les cellules, sites et espèces deja presentes dans coleo ####</span>

<span class="co"># Test pour vérifier l'existence des cellules dans Coléo</span>
<span class="va">cell_abs</span> <span class="op">&lt;-</span> <span class="fu">rcoleo</span><span class="fu">::</span><span class="fu"><a href="../reference/COLEO_comp.html">COLEO_comp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">camp</span><span class="op">$</span><span class="va">cell_code</span><span class="op">)</span>,
                               <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">cells</span><span class="op">$</span><span class="va">cell_code</span><span class="op">)</span><span class="op">)</span>
<span class="va">cell_abs</span></code></pre></div>
<p>La sortie R vous indique si vous pouvez passer à l’étape suivante ou non. Dans le cas où certaines cellules n’existent pas dans Coléo, il sera nécessaire de les importer avant de continuer l’insertions des nouvelles campagnes. Pour ce faire, vous pouvez utiliser l’objet <code>cell_abs</code> que vous venez de créer et qui contient la liste des cellules à injecter dans Coléo. Suivez les étapes détaillées en déroulant la vignette <strong>Injection des cellules</strong> ci-dessous.</p>
<script>
function myFunction1() {
    var x = document.getElementById("myDIV_cells");
    if (x.style.display === "none") {
        x.style.display = "block";
    } else {
        x.style.display = "none";
    }
}
</script><div id="myDIV_cells">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">shp_cells</span> <span class="op">&lt;-</span> <span class="fu">rgdal</span><span class="fu">::</span><span class="fu">readOGR</span><span class="op">(</span>dsn <span class="op">=</span> <span class="st">"./shp"</span>,
                            layer <span class="op">=</span> <span class="st">"Cellule_terrain_2016-2020"</span><span class="op">)</span> <span class="co"># Ici le fichier shapefile est placé dans un dossier shp et on appelle tous les fichiers nommés "Cellule_terrain_2016_2020"</span>

<span class="co"># Création d'une liste vide pour l'objet final</span>
<span class="va">shp_cells_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cell_abs</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>

<span class="co"># Obtention des information pour un cellule</span>
  <span class="va">shp</span> <span class="op">&lt;-</span> <span class="va">shp_cells</span><span class="op">[</span><span class="va">shp_cells</span><span class="op">$</span><span class="va">IJ</span> <span class="op">==</span> <span class="va">cell_abs</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> ,<span class="op">]</span>

<span class="co"># Création d'une liste avec les informations nécessaires pour chaque cellule</span>
  <span class="va">cells_ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
  <span class="va">cells_ls</span><span class="op">$</span><span class="va">cell_code</span> <span class="op">&lt;-</span> <span class="va">cell_abs</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="co"># Code de la cellule</span>
  <span class="va">cells_ls</span><span class="op">$</span><span class="va">name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">shp_cells</span><span class="op">[</span><span class="va">shp_cells</span><span class="op">$</span><span class="va">IJ</span> <span class="op">==</span> <span class="va">cell_abs</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">shp_cells</span><span class="op">$</span><span class="va">Nom</span><span class="op">)</span>,<span class="op">]</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">Nom</span><span class="op">)</span> <span class="co"># Nom de la cellule</span>

  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">cells_ls</span><span class="op">$</span><span class="va">name</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  
    <span class="va">cells_ls</span><span class="op">$</span><span class="va">name</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
    
  <span class="op">}</span> <span class="co"># Information absente si pas de nom pour la cellule</span>

<span class="co"># Création de l'objet spatial pour les coordonnées de la cellule</span>
  <span class="va">shp_sp</span> <span class="op">&lt;-</span> <span class="fu">as</span><span class="op">(</span><span class="va">shp</span>, <span class="st">"SpatialPolygons"</span><span class="op">)</span>
  <span class="va">cells_ls</span><span class="op">$</span><span class="va">geom</span> <span class="op">&lt;-</span> <span class="fu">geojsonio</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/geojsonio/reference/geojson_list.html" class="external-link">geojson_list</a></span><span class="op">(</span><span class="va">shp</span><span class="op">)</span><span class="op">$</span><span class="va">features</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">geometry</span> <span class="co"># Caractéristiques de l'objet spatial</span>
  <span class="va">cells_ls</span><span class="op">$</span><span class="va">geom</span><span class="op">$</span><span class="va">crs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"name"</span>,
                            properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"EPSG:4326"</span><span class="op">)</span><span class="op">)</span> <span class="co"># Information sur le systême de coordonnées de référence (CRS)</span>

<span class="co"># Alimentation de l'objet final avec un niveau pour chaque cellule</span>
  <span class="va">shp_cells_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">cells_ls</span>
<span class="op">}</span>

<span class="co"># Envoi de la liste de nouvelles cellules vers Coléo</span>
<span class="va">COLEO_cells</span> <span class="op">&lt;-</span> <span class="fu">rcoleo</span><span class="fu">::</span><span class="fu"><a href="../reference/post_cells.html">post_cells</a></span><span class="op">(</span><span class="va">shp_cells_list</span><span class="op">)</span>

<span class="co"># Mise à jour de la liste des cellules provenant de Coléo</span>
<span class="fu">rcoleo</span><span class="fu">:::</span><span class="fu"><a href="../reference/clear_cache_rcoleo.html">clear_cache_rcoleo</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">cells</span> <span class="op">&lt;-</span> <span class="fu">rcoleo</span><span class="fu">::</span><span class="fu"><a href="../reference/get_cells.html">get_cells</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">cells</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="fu">plyr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/plyr/man/rbind.fill.html" class="external-link">rbind.fill</a></span>, <span class="va">cells</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">body</span><span class="op">)</span></code></pre></div>
</div>
<script>
document.getElementById("myDIV_cells").style.display ="none"
</script><button onclick="myFunction1()">
Vignette Injection des cellules
</button>
<p>Vous pouvez maintenant récupérer l’ID unique des cellules.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Récupération des cell_id</span>
<span class="va">camp</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">camp</span>,
                         <span class="va">cells</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"cell_code"</span><span class="op">)</span><span class="op">]</span>,
                         by <span class="op">=</span> <span class="st">"cell_code"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">camp</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">camp</span><span class="op">)</span> <span class="op">==</span> <span class="st">"id"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"cell_id"</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Test pour vérifier l'existence des sites dans Coléo</span>
<span class="va">site_abs</span> <span class="op">&lt;-</span> <span class="fu">rcoleo</span><span class="fu">::</span><span class="fu"><a href="../reference/COLEO_comp.html">COLEO_comp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">camp</span><span class="op">$</span><span class="va">site_code</span><span class="op">)</span>,
                               <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">sites</span><span class="op">$</span><span class="va">site_code</span><span class="op">)</span><span class="op">)</span>
<span class="va">site_abs</span></code></pre></div>
<p>La sortie R vous indique si vous pouvez passer à l’étape suivante ou non. Dans le cas où certaines cellules n’existent pas dans Coléo, il sera nécessaire de les importer avant de continuer l’insertions des nouvelles campagnes. Pour ce faire, vous pouvez utiliser l’objet <code>site_abs</code> que vous venez de créer et qui contient la liste des sites à injecter dans Coléo. Suivez les étapes détaillées en déroulant la vignette <strong>Injection des sites</strong> ci-dessous.</p>
<script>
function myFunction2() {
    var x = document.getElementById("myDIV_sites");
    if (x.style.display === "none") {
        x.style.display = "block";
    } else {
        x.style.display = "none";
    }
}
</script><div id="myDIV_sites">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Sélection des lignes du tableau concernant les sites manquants</span>
<span class="va">site_df</span> <span class="op">&lt;-</span> <span class="va">camp</span><span class="op">[</span><span class="va">camp</span><span class="op">$</span><span class="va">site_code</span> <span class="op">%in%</span> <span class="va">site_abs</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cell_id"</span>, <span class="st">"site_code"</span>, <span class="st">"type_hab"</span>, <span class="st">"opened_at"</span>, <span class="st">"lat"</span>, <span class="st">"lon"</span><span class="op">)</span><span class="op">]</span>

<span class="co"># Retrait des lignes dupliquées</span>
<span class="va">site_df</span> <span class="op">&lt;-</span> <span class="va">site_df</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">site_df</span><span class="op">)</span>,<span class="op">]</span>

<span class="co"># Changement du nom de la variable "type_hab" pour correspondre à celle de Coléo ("type")</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">site_df</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">site_df</span><span class="op">)</span> <span class="op">==</span> <span class="st">"type_hab"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"type"</span>

<span class="co"># Création de la variable geom à partir des variables "lat" &amp; "lon"</span>
<span class="va">site_df_ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">site_df</span>, <span class="fl">1</span>, <span class="va">as.list</span><span class="op">)</span> <span class="co"># Création de la liste</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">site_df_ls</span><span class="op">)</span> <span class="co"># Vérification de la structure de l'objet</span>

<span class="va">geom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">site_df</span>,<span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>

  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="st">"lat"</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="st">"lon"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  
    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">geojsonio</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/geojsonio/reference/geojson_list.html" class="external-link">geojson_list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="st">"lon"</span><span class="op">]</span>, <span class="va">x</span><span class="op">[</span><span class="st">"lat"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">features</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">geometry</span><span class="op">)</span>
    
  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
  
    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>
    
  <span class="op">}</span><span class="op">}</span><span class="op">)</span>

<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">site_df_ls</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="co"># Fusionner les deux listes (geomations + sites)</span>

  <span class="va">site_df_ls</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">geom</span> <span class="op">&lt;-</span> <span class="va">geom</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">is.list</a></span><span class="op">(</span><span class="va">site_df_ls</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">geom</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  
    <span class="va">site_df_ls</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">geom</span><span class="op">$</span><span class="va">crs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"name"</span>,
                                     properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"EPSG:4326"</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span>

<span class="co"># Envoi de la liste des nouveaux sites vers Coléo</span>
<span class="va">COLEO_sites</span> <span class="op">&lt;-</span> <span class="fu">rcoleo</span><span class="fu">::</span><span class="fu"><a href="../reference/post_sites.html">post_sites</a></span><span class="op">(</span><span class="va">site_df_ls</span><span class="op">)</span>

<span class="co"># Mise à jour de la liste des sites provenant de Coléo</span>
<span class="fu">rcoleo</span><span class="fu">:::</span><span class="fu"><a href="../reference/clear_cache_rcoleo.html">clear_cache_rcoleo</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">sites</span> <span class="op">&lt;-</span> <span class="fu">rcoleo</span><span class="fu">::</span><span class="fu"><a href="../reference/get_sites.html">get_sites</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">sites</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="fu">plyr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/plyr/man/rbind.fill.html" class="external-link">rbind.fill</a></span>, <span class="va">sites</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">body</span><span class="op">)</span></code></pre></div>
</div>
<script>
document.getElementById("myDIV_sites").style.display ="none"
</script><button onclick="myFunction2()">
Vignette Injection des sites
</button>
<p>Vous pouvez maintenant récupérer l’ID unique des sites.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Récupération des site_id</span>
<span class="va">camp</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">camp</span>,
                         <span class="va">sites</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"site_code"</span><span class="op">)</span><span class="op">]</span>,
                         by <span class="op">=</span> <span class="st">"site_code"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">camp</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">camp</span><span class="op">)</span> <span class="op">==</span> <span class="st">"id"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"site_id"</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Test pour vérifier l'existence des noms des espèces dans Coléo</span>
<span class="va">sp_abs</span> <span class="op">&lt;-</span> <span class="fu">rcoleo</span><span class="fu">::</span><span class="fu"><a href="../reference/COLEO_comp.html">COLEO_comp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">camp</span><span class="op">$</span><span class="va">taxa_name</span><span class="op">)</span>,
                             <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">species</span><span class="op">$</span><span class="va">name</span><span class="op">)</span><span class="op">)</span>
<span class="va">sp_abs</span></code></pre></div>
<p>La sortie R vous indique si vous pouvez passer à l’étape suivante ou non. Dans le cas où certaines cellules n’existent pas dans Coléo, il sera nécessaire de les importer avant de continuer l’insertions des nouvelles campagnes. Pour ce faire, vous pouvez utiliser l’objet <code>sp_abs</code> que vous venez de créer et qui contient la liste des noms d’espèces à injecter dans Coléo. Suivez les étapes détaillées en déroulant la vignette <strong>Injection des noms d’espèces</strong> ci-dessous.</p>
<script>
function myFunction3() {
    var x = document.getElementById("myDIV_taxa");
    if (x.style.display === "none") {
        x.style.display = "block";
    } else {
        x.style.display = "none";
    }
}
</script><div id="myDIV_taxa">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Formatage du tableau à insérer</span>
<span class="va">taxa_df</span> <span class="op">&lt;-</span> <span class="va">camp</span><span class="op">[</span><span class="va">camp</span><span class="op">$</span><span class="va">taxa_name</span> <span class="op">%in%</span> <span class="va">sp_abs</span>,<span class="op">]</span>
<span class="va">taxa_df</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">taxa_df</span>,
                    name <span class="op">=</span> <span class="va">taxa_name</span>,
                    <span class="va">vernacular_fr</span>,
                    <span class="va">rank</span>,
                    <span class="va">category</span>,
                    <span class="va">tsn</span><span class="op">)</span> <span class="co"># colonnes nécessaires</span>

<span class="co"># Retrait des lignes dupliquées</span>
<span class="va">taxa_df</span> <span class="op">&lt;-</span> <span class="va">taxa_df</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">taxa_df</span><span class="op">)</span>,<span class="op">]</span> 

<span class="co"># Formatage des données sous forme de liste</span>
<span class="va">taxa_df_ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">taxa_df</span>, <span class="fl">1</span>, <span class="va">as.list</span><span class="op">)</span>

<span class="co"># Injection</span>
<span class="va">COLEO_taxa</span> <span class="op">&lt;-</span> <span class="fu">rcoleo</span><span class="fu">::</span><span class="fu"><a href="../reference/post_species.html">post_species</a></span><span class="op">(</span><span class="va">taxa_df_ls</span><span class="op">)</span></code></pre></div>
</div>
<script>
document.getElementById("myDIV_taxa").style.display ="none"
</script><button onclick="myFunction3()">
Vignette injection noms d’espèce
</button>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#### Etape 7 - Injecter les campagnes ODONATES/PAPILIONIDES dans COLEO ####</span>
<span class="va">camp</span> <span class="op">&lt;-</span> <span class="va">campaign</span>

<span class="co"># Retrait des lignes avec NA dans taxa_name</span>
<span class="va">camp</span> <span class="op">&lt;-</span> <span class="va">camp</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">camp</span><span class="op">$</span><span class="va">taxa_name</span><span class="op">)</span>,<span class="op">]</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 7.1.1. Sélection</span>
<span class="va">camp_camp</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">camp</span>,
                           <span class="va">site_id</span>,
                           <span class="va">type</span>,
                           <span class="va">technicians</span>,
                           <span class="va">opened_at</span>,
                           <span class="va">closed_at</span><span class="op">)</span>
<span class="co"># 7.1.2. Retrait des duplicat</span>
<span class="va">camp_camp</span> <span class="op">&lt;-</span> <span class="va">camp_camp</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">camp_camp</span><span class="op">)</span>,<span class="op">]</span>
<span class="co"># 7.1.4. Conversion de l'objet pour l'injection</span>
<span class="va">camp_ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">camp_camp</span>, <span class="fl">1</span>, <span class="va">as.list</span><span class="op">)</span>
<span class="co"># 7.1.5. Injection</span>
<span class="va">COLEO_camp_inj</span> <span class="op">&lt;-</span> <span class="fu">rcoleo</span><span class="fu">::</span><span class="fu"><a href="../reference/post_campaigns.html">post_campaigns</a></span><span class="op">(</span><span class="va">camp_ls</span><span class="op">)</span> 

<span class="co"># 7.1.6. Liste des campagnes</span>
<span class="va">campaigns</span> <span class="op">&lt;-</span> <span class="fu">rcoleo</span><span class="fu">::</span><span class="fu"><a href="../reference/get_campaigns.html">get_campaigns</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">campaigns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="fu">plyr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/plyr/man/rbind.fill.html" class="external-link">rbind.fill</a></span>, <span class="va">campaigns</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">body</span><span class="op">)</span>

<span class="co"># 7.1.7. Récupération des IDs des campagnes</span>
<span class="va">camp</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">camp</span>,
                         <span class="va">campaigns</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"site_id"</span>, <span class="st">"opened_at"</span>, <span class="st">"type"</span><span class="op">)</span><span class="op">]</span>,
                         by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"site_id"</span>, <span class="st">"opened_at"</span>, <span class="st">"type"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">camp</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">camp</span><span class="op">)</span> <span class="op">==</span> <span class="st">"id"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"campaign_id"</span>

<span class="co"># 7.2.1. Sélection</span>
<span class="va">land_camp</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">camp</span>,
                           <span class="va">campaign_id</span>,
                           <span class="va">lat</span>,
                           <span class="va">lon</span><span class="op">)</span>

<span class="co"># 7.2.2. Retrait des duplicats</span>
<span class="va">land_camp</span> <span class="op">&lt;-</span> <span class="va">land_camp</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">land_camp</span><span class="op">)</span>,<span class="op">]</span>
<span class="co"># 7.2.3. Conversion de l'objet pour l'injection</span>
<span class="va">land_ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">land_camp</span>, <span class="fl">1</span>, <span class="va">as.list</span><span class="op">)</span>
<span class="co"># 7.2.4. Création de la variable `geom`</span>
<span class="va">geom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">land_camp</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>
  
  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="st">"lat"</span><span class="op">]</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="st">"lon"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    
    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">geojsonio</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/geojsonio/reference/geojson_list.html" class="external-link">geojson_list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="st">"lon"</span><span class="op">]</span>,<span class="va">x</span><span class="op">[</span><span class="st">"lat"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">features</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">geometry</span><span class="op">)</span>
    
  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
    
    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>
    
  <span class="op">}</span><span class="op">}</span><span class="op">)</span>
<span class="co"># 7.2.5. Fusion des listes</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">land_ls</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  
  <span class="va">land_ls</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">geom</span> <span class="op">&lt;-</span> <span class="va">geom</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
  
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">is.list</a></span><span class="op">(</span><span class="va">land_ls</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">geom</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    
    <span class="va">land_ls</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">geom</span><span class="op">$</span><span class="va">crs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"name"</span>, properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"EPSG:4326"</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span>
<span class="co"># 7.2.6. Injection</span>
<span class="va">COLEO_land_inj</span> <span class="op">&lt;-</span> <span class="fu">rcoleo</span><span class="fu">::</span><span class="fu"><a href="../reference/post_landmarks.html">post_landmarks</a></span><span class="op">(</span><span class="va">land_ls</span><span class="op">)</span>
<span class="co"># 7.3.1. Sélection</span>
<span class="va">env_camp</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">camp</span>,
                   <span class="va">campaign_id</span>,
                   <span class="va">wind</span>,
                   <span class="va">sky</span>,
                   <span class="va">temp_c</span><span class="op">)</span>
<span class="co"># 7.3.2. Retrait des duplicats</span>
<span class="va">env_camp</span> <span class="op">&lt;-</span> <span class="va">env_camp</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">env_camp</span><span class="op">)</span>,<span class="op">]</span>

<span class="co"># Conversion des variables</span>
<span class="va">env_camp</span><span class="op">$</span><span class="va">wind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">env_camp</span><span class="op">$</span><span class="va">wind</span><span class="op">)</span>
<span class="va">env_camp</span><span class="op">$</span><span class="va">sky</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">env_camp</span><span class="op">$</span><span class="va">sky</span><span class="op">)</span>
<span class="co"># 7.3.3. Conversion de l'objet pour l'injection</span>
<span class="va">env_camp_ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">env_camp</span>, <span class="fl">1</span>, <span class="va">as.list</span><span class="op">)</span>
<span class="co"># 7.3.4. Injection</span>
<span class="va">COLEO_env_inj</span> <span class="op">&lt;-</span> <span class="fu">rcoleo</span><span class="fu">::</span><span class="fu"><a href="../reference/post_environments.html">post_environments</a></span><span class="op">(</span><span class="va">env_camp_ls</span><span class="op">)</span>
<span class="co"># 7.4.1. Sélection</span>
<span class="va">eff_camp</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">camp</span>,
                   <span class="va">campaign_id</span>,
                   <span class="va">time_start</span>,
                   <span class="va">time_finish</span><span class="op">)</span>
<span class="co"># 7.4.2. Retrait des duplicats</span>
<span class="va">eff_camp</span> <span class="op">&lt;-</span> <span class="va">eff_camp</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">eff_camp</span><span class="op">)</span>,<span class="op">]</span>
<span class="co"># 7.4.3. Conversion de l'objet pour l'injection</span>
<span class="va">eff_camp_ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">eff_camp</span>, <span class="fl">1</span>, <span class="va">as.list</span><span class="op">)</span>
<span class="co"># 7.4.4. Injection</span>
<span class="va">COLEO_eff_inj</span> <span class="op">&lt;-</span> <span class="fu">rcoleo</span><span class="fu">::</span><span class="fu"><a href="../reference/post_efforts.html">post_efforts</a></span><span class="op">(</span><span class="va">eff_camp_ls</span><span class="op">)</span> 
<span class="co"># 7.5.1. Création &amp; sélection</span>
<span class="co"># Création de 2 variables nécessaires</span>
<span class="va">camp</span><span class="op">$</span><span class="va">date_obs</span> <span class="op">&lt;-</span> <span class="va">camp</span><span class="op">$</span><span class="va">opened_at</span>
<span class="va">camp</span><span class="op">$</span><span class="va">is_valid</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="co"># valeur de 1 par défaut</span>

<span class="co"># Sélection des champs d'intérêts</span>
<span class="va">obs_camp</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">camp</span>,
                   <span class="va">date_obs</span>,
                   <span class="va">is_valid</span>,
                   notes <span class="op">=</span> <span class="va">note</span>,
                   <span class="va">campaign_id</span><span class="op">)</span>
<span class="co"># 7.5.2. Retrait des duplicats</span>
<span class="va">obs_camp</span> <span class="op">&lt;-</span> <span class="va">obs_camp</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">obs_camp</span><span class="op">)</span>,<span class="op">]</span>
<span class="co"># 7.5.3. Conversion de l'objet pour l'insertion</span>
<span class="va">obs_camp_ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">obs_camp</span>, <span class="fl">1</span>, <span class="va">as.list</span><span class="op">)</span>
<span class="co"># 7.5.4. Injection</span>
<span class="va">COLEO_obs_inj</span> <span class="op">&lt;-</span> <span class="fu">rcoleo</span><span class="fu">::</span><span class="fu"><a href="../reference/post_obs.html">post_obs</a></span><span class="op">(</span><span class="va">obs_camp_ls</span><span class="op">)</span>

<span class="co"># 7.5.5. Acquisition de la liste d'observations de Coléo</span>
<span class="va">obs</span> <span class="op">&lt;-</span> <span class="fu">rcoleo</span><span class="fu">::</span><span class="fu"><a href="../reference/get_gen.html">get_gen</a></span><span class="op">(</span><span class="st">"/observations"</span><span class="op">)</span>
<span class="va">obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="fu">plyr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/plyr/man/rbind.fill.html" class="external-link">rbind.fill</a></span>, <span class="va">obs</span><span class="op">$</span><span class="va">body</span><span class="op">)</span>

<span class="co"># Mise à jour des données à injecter avec l'observation_id</span>
<span class="va">camp</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">camp</span>,
                         <span class="va">obs</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"campaign_id"</span>, <span class="st">"date_obs"</span><span class="op">)</span><span class="op">]</span>,
                         by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"campaign_id"</span>, <span class="st">"date_obs"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">camp</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">camp</span><span class="op">)</span> <span class="op">==</span> <span class="st">"id"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"observation_id"</span>
<span class="co"># 7.6.1. Sélection</span>
<span class="va">obs_spe_camp</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">camp</span>,
                       <span class="va">observation_id</span>,
                       value <span class="op">=</span> <span class="va">abondance</span>,
                       <span class="va">taxa_name</span><span class="op">)</span>

<span class="co"># Ajout d'une variable</span>
<span class="va">obs_spe_camp</span><span class="op">$</span><span class="va">variable</span> <span class="op">&lt;-</span> <span class="st">"abondance"</span>

<span class="co"># 7.6.2. Conversion de l'objet pour l'injection</span>
<span class="va">obs_spe_camp_ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">obs_spe_camp</span>, <span class="fl">1</span>, <span class="va">as.list</span><span class="op">)</span>

<span class="co"># 7.6.3. Injection</span>
<span class="va">COLEO_obsref_inj</span> <span class="op">&lt;-</span> <span class="fu">rcoleo</span><span class="fu">::</span><span class="fu"><a href="../reference/post_obs_species.html">post_obs_species</a></span><span class="op">(</span><span class="va">obs_spe_camp_ls</span><span class="op">)</span></code></pre></div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Steve Vissault.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link external-link">pkgdown</a> 1.6.1.9001.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'API_KEY',
    indexName: 'INDEX_NAME',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
