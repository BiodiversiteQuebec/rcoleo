<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tutoriel pour injection des campagnes papillon • rcoleo</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Tutoriel pour injection des campagnes papillon">
<meta property="og:description" content="rcoleo">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rcoleo</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://coleo.biodiversite-quebec.ca/docs/">
    <span class="fa fa-book fa-lg"></span>
     
  </a>
</li>
<li>
  <a></a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/telecharge-sites.html">Téléchargement des sites</a>
    </li>
    <li>
      <a href="../articles/injection-cellules.html">Injection des cellules</a>
    </li>
    <li>
      <a href="../articles/injection-taxa.html">Injection des noms d'espèce</a>
    </li>
    <li>
      <a href="../articles/injection-sites.html">Injection des sites</a>
    </li>
    <li>
      <a href="../articles/CAMPAGNE_zooplancton_injection.html">Injection des campagnes ZOOPLANCTON</a>
    </li>
    <li>
      <a href="../articles/CAMPAGNE_papillon_injection.html">Injection des campagnes PAPILONIDÉS</a>
    </li>
    <li>
      <a href="../articles/CAMPAGNE_odonate_injection.html">Injection des campagnes ODONATES</a>
    </li>
    <li>
      <a href="../articles/CAMPAGNE_insects_sol_injection.html">Injection des campagnes INSECTES SOL</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ReseauBiodiversiteQuebec/rcoleo">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="CAMPAGNE_papillon_injection_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Tutoriel pour injection des campagnes papillon</h1>
                        <h4 class="author">Claire-Cécile Juhasz</h4>
            
            <h4 class="date">19 novembre 2020</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ReseauBiodiversiteQuebec/rcoleo/blob/master/vignettes/CAMPAGNE_papillon_injection.Rmd"><code>vignettes/CAMPAGNE_papillon_injection.Rmd</code></a></small>
      <div class="hidden name"><code>CAMPAGNE_papillon_injection.Rmd</code></div>

    </div>

    
    
<style>
div.red { background-color:#ff0000; border-radius: 8px; padding: 5px;}
</style>
<style>
div.blue { background-color:#e6f0ff; border-radius: 8px; padding: 5px;}
</style>
<div class="red">
<p>Vignette en cours de développement</p>
</div>
<div id="créer-une-base-de-données-excel" class="section level2">
<h2 class="hasAnchor">
<a href="#cr%C3%A9er-une-base-de-donn%C3%A9es-excel" class="anchor"></a>1. Créer une base de données excel</h2>
<p>Afin d’injecter des nouvelles campagnes faisant l’inventaire des papillons, il vous faut créer un fichier excel avec les colonnes suivantes :</p>
<table class="table">
<colgroup>
<col width="9%">
<col width="90%">
</colgroup>
<thead><tr class="header">
<th>Variable</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><em>cell_code</em></td>
<td>code numérique unique pour chaque cellule</td>
</tr>
<tr class="even">
<td><em>site_code</em></td>
<td>code alpha-numérique unique du site</td>
</tr>
<tr class="odd">
<td><strong>type_hab</strong></td>
<td>type d’habitat dans lequel la campagne a été effectuée - <code>lac</code>, <code>rivière</code>, <code>forestier</code>, <code>marais</code>, <code>marais côtier</code>, <code>toundrique</code>, <code>tourbière</code>
</td>
</tr>
<tr class="even">
<td><em>lat</em></td>
<td>latitude du site d’échantillonnage</td>
</tr>
<tr class="odd">
<td><em>lon</em></td>
<td>longitude du site d’échantillonnage</td>
</tr>
<tr class="even">
<td><strong>opened_at</strong></td>
<td>date du début de la campagne au format <code>YYYY-MM-DD</code>
</td>
</tr>
<tr class="odd">
<td><em>closed_at</em></td>
<td>date de la fin de la campagne au format <code>YYYY-MM-DD</code>
</td>
</tr>
<tr class="even">
<td><em>technician_1</em></td>
<td></td>
</tr>
<tr class="odd">
<td><em>technician_2</em></td>
<td></td>
</tr>
<tr class="even">
<td><em>time_start</em></td>
<td>heure du début de la campagne</td>
</tr>
<tr class="odd">
<td><em>time_finish</em></td>
<td>heure de la fin de la campagne</td>
</tr>
<tr class="even">
<td><em>temp_c</em></td>
<td>température en degré celsius</td>
</tr>
<tr class="odd">
<td><strong>type</strong></td>
<td>type de campagne - <code>papilionidés</code>
</td>
</tr>
<tr class="even">
<td><strong>sky</strong></td>
<td>variable numérique symbolisant l’état du ciel, 1 = <code>dégagé (0 à 10 %)</code>, 2 = <code>partiellement nuageux (10 à 50 %)</code>, 3 = <code>nuageux (50 à 90 %)</code>, 4 = <code>pluvieux</code>, 5 = <code>orageux</code>
</td>
</tr>
<tr class="odd">
<td><strong>wind</strong></td>
<td>variable numérique symbolisant le niveau d’intensité du vent, 1 = <code>calme (moins de 1 km/h)</code>, 2 = <code>très légère brise (1 à 5 km/h)</code>, 3 = <code>légère brise (6 à 11 km/h)</code>, 4 = <code>petite brise (12 à 19 km/h)</code>, 5 = <code>jolie brise (20 à 28 km/h)</code>
</td>
</tr>
<tr class="even">
<td><em>vernacular_fr</em></td>
<td>nom commun français des espèces observées</td>
</tr>
<tr class="odd">
<td><em>taxa_name</em></td>
<td>nom latin des espèces observées</td>
</tr>
<tr class="even">
<td><em>abondance</em></td>
<td>valeur d’abondance de l’espèce observée</td>
</tr>
<tr class="odd">
<td><em>note</em></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>Prenez soin de :</p>
<ul>
<li>vérifier les <strong>variables en gras</strong> car elles possèdent des valeurs prédéfinies dans Coléo. Toutes les valeurs dans votre fichier doivent correspondre à une des valeurs possibles (vérifiez les majuscule, les accents ou d’éventuelles espaces inutiles).</li>
<li>ne pas laisser de case vide. Inscrivez <em>NA</em> lorsque nécessaire.</li>
<li>vérifier que votre fichier ne contienne que des nouvelles campagnes.</li>
<li>vérifier l’encodage de votre fichier qui doit correspondre à “UTF-8”.</li>
</ul>
</div>
<div id="corriger-la-base-de-données" class="section level2">
<h2 class="hasAnchor">
<a href="#corriger-la-base-de-donn%C3%A9es" class="anchor"></a>2. Corriger la base de données</h2>
<p>Il est très important de s’assurer que la base de données excel soit sans erreur <strong>avant</strong> de l’injecter dans Coléo. Coléo n’a pas de système de correction et va prendre toutes les entrées, même si elles contiennent des erreurs.</p>
</div>
<div id="créer-un-projet-r" class="section level2">
<h2 class="hasAnchor">
<a href="#cr%C3%A9er-un-projet-r" class="anchor"></a>3. Créer un projet R</h2>
<p>Dans RStudio,</p>
<ul>
<li>Aller dans <code>File</code> &gt; <code>New Project</code> &gt; <code>New Directory</code> &gt; <code>New Project</code>
</li>
<li>Choisir un nom de projet et un lieu dans les fichiers pour le projet</li>
</ul>
<p>Les projets permettent de travailler dans un répertoire de travail (<em>working directory</em>). La base de données doit donc être sauvegardée dans le même dossier que le projet afin de faire parti du répertoire de travail.</p>
</div>
<div id="sauvegarder-la-base-de-données-en-format--csv-dans-le-même-dossier-que-le-projet-r" class="section level2">
<h2 class="hasAnchor">
<a href="#sauvegarder-la-base-de-donn%C3%A9es-en-format--csv-dans-le-m%C3%AAme-dossier-que-le-projet-r" class="anchor"></a>4. Sauvegarder la base de données en format .csv dans le même dossier que le projet R</h2>
<div class="blue">
<p><strong>Rappel</strong> - L’encodage du fichier .csv doit être en “UTF-8”</p>
</div>
</div>
<div id="installer-et-charger-les-packages-nécessaires" class="section level2">
<h2 class="hasAnchor">
<a href="#installer-et-charger-les-packages-n%C3%A9cessaires" class="anchor"></a>5. Installer et charger les packages nécessaires</h2>
<p>S’il ne s’agit pas de vos premières injections dans Coléo avec R, vous pouvez directement passer à l’<strong>étape 5.2</strong>. Sinon vous devez installer les packages nécessaires.</p>
<div id="installation-des-packages" class="section level3">
<h3 class="hasAnchor">
<a href="#installation-des-packages" class="anchor"></a>5.1. Installation des packages</h3>
<p>Dans RStudio :</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 5.1. Installation des packages</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"plyr"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"dplyr"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"geojsonio"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"readr"</span><span class="op">)</span></code></pre></div>
<p>Pour installer le package <code>rcoleo</code>, il faut utiliser le package <code>devtools</code>, il faut donc l’appeller avec <code><a href="https://rdrr.io/r/base/library.html">library()</a></code></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Chargement de devtools</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">devtools</span><span class="op">)</span>
<span class="co"># Installation du package rcoleo à partir de github</span>
<span class="fu">install_github</span><span class="op">(</span><span class="st">"ReseauBiodiversiteQuebec/rcoleo"</span><span class="op">)</span> </code></pre></div>
</div>
<div id="chargement-des-packages" class="section level3">
<h3 class="hasAnchor">
<a href="#chargement-des-packages" class="anchor"></a>5.2. Chargement des packages</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 5.2. Chargement des packages</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ReseauBiodiversiteQuebec/rcoleo">rcoleo</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://had.co.nz/plyr">plyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">geojsonio</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">readr</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="mise-en-cache-son-jeton-daccès" class="section level2">
<h2 class="hasAnchor">
<a href="#mise-en-cache-son-jeton-dacc%C3%A8s" class="anchor"></a>6. Mise en cache son jeton d’accès</h2>
<p>Ce jeton permet d’apporter des modifications dans Coléo. Il est unique et se retrouve dans Coléo, sous le profil de l’utilisateur dans le menu à gauche.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 6. Mise en cache son jeton d'accès</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="st">"votrejeton"</span>,<span class="st">".httr-oauth"</span><span class="op">)</span></code></pre></div>
<p>Cette étape n’est faite qu’une fois et permet l’enregistrement de votre jeton dans le répertoire du projet R. Une fois faite, elle est supprimée du code d’injection. Le jeton est confidentiel.</p>
</div>
<div id="vérification-pré-injection" class="section level2">
<h2 class="hasAnchor">
<a href="#v%C3%A9rification-pr%C3%A9-injection" class="anchor"></a>7. Vérification pré-injection</h2>
<p>La succession d’étape qui suivent permettent de vérifier si les cellules, les sites, les noms d’espèces et les attributs associés aux campagnes à injecter existent déjà dans Coléo.</p>
<div id="création-dun-objet-r-avec-les-nouvelles-campagnes-à-insérer-dans-coléo" class="section level3">
<h3 class="hasAnchor">
<a href="#cr%C3%A9ation-dun-objet-r-avec-les-nouvelles-campagnes-%C3%A0-ins%C3%A9rer-dans-col%C3%A9o" class="anchor"></a>7.1. Création d’un objet R avec les nouvelles campagnes à insérer dans Coléo</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 7.1. Création d'un objet contenant les nouvelles campagnes</span>
<span class="va">camp</span> <span class="op">&lt;-</span> <span class="fu">read_delim</span><span class="op">(</span><span class="st">"./lenomdevotrebasededonnées.csv"</span>,
                   sep <span class="op">=</span> <span class="st">';'</span><span class="op">)</span></code></pre></div>
<div class="blue">
<p><strong>Vérification</strong> - Il est important de vérifier dans votre console si le tableau <code>camp</code> que vous venez de créer dans R possède bien le nombre de lignes et de colonnes attendu.</p>
</div>
</div>
<div id="acquisition-de-la-liste-des-cellules-des-sites-des-noms-despèce-de-référence-et-des-attributs-déjà-présentes-dans-coléo-et-création-dun-objet-r-pour-chacune" class="section level3">
<h3 class="hasAnchor">
<a href="#acquisition-de-la-liste-des-cellules-des-sites-des-noms-desp%C3%A8ce-de-r%C3%A9f%C3%A9rence-et-des-attributs-d%C3%A9j%C3%A0-pr%C3%A9sentes-dans-col%C3%A9o-et-cr%C3%A9ation-dun-objet-r-pour-chacune" class="anchor"></a>7.2. Acquisition de la liste des cellules, des sites, des noms d’espèce de référence et des attributs déjà présentes dans Coléo et création d’un objet R pour chacune</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 7.2. Acquisition des informations dans Coléo</span>
<span class="co"># Acquisition cellules Coléo</span>
<span class="va">cells</span> <span class="op">&lt;-</span> <span class="fu">rcoleo</span><span class="fu">::</span><span class="fu"><a href="../reference/get_cells.html">get_cells</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">cells</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="st">"rbind"</span>, <span class="va">cells</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">body</span><span class="op">)</span>

<span class="co"># Acquisition sites Coléo</span>
<span class="va">sites</span> <span class="op">&lt;-</span> <span class="fu">rcoleo</span><span class="fu">::</span><span class="fu"><a href="../reference/get_sites.html">get_sites</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">sites</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="st">"rbind"</span>, <span class="va">sites</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">body</span><span class="op">)</span>

<span class="co"># Acquisition nom espèces Coléo</span>
<span class="va">species</span> <span class="op">&lt;-</span> <span class="fu">rcoleo</span><span class="fu">::</span><span class="fu"><a href="../reference/get_species.html">get_species</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="st">"rbind"</span>, <span class="va">species</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">body</span><span class="op">)</span>

<span class="co"># Acquisition des attributs dans Coléo</span>
<span class="va">attrs</span> <span class="op">&lt;-</span> <span class="fu">rcoleo</span><span class="fu">::</span><span class="fu"><a href="../reference/get_gen.html">get_gen</a></span><span class="op">(</span><span class="st">"/attributes"</span><span class="op">)</span>
<span class="va">attrs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="fu">plyr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/plyr/man/rbind.fill.html">rbind.fill</a></span>, <span class="va">attrs</span><span class="op">$</span><span class="va">body</span><span class="op">)</span></code></pre></div>
</div>
<div id="vérification-de-lexistence-des-cellules-sites-noms-despèces-et-des-attributs-associés-aux-nouvelles-campagnes-dans-coléo" class="section level3">
<h3 class="hasAnchor">
<a href="#v%C3%A9rification-de-lexistence-des-cellules-sites-noms-desp%C3%A8ces-et-des-attributs-associ%C3%A9s-aux-nouvelles-campagnes-dans-col%C3%A9o" class="anchor"></a>7.3. Vérification de l’existence des cellules, sites, noms d’espèces et des attributs associés aux nouvelles campagnes dans Coléo</h3>
<div id="pour-les-cellules" class="section level4">
<h4 class="hasAnchor">
<a href="#pour-les-cellules" class="anchor"></a>7.3.1. Pour les cellules</h4>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 7.3.1. Vérification</span>
<span class="co"># Test pour vérifier l'existence des cellules dans Coléo</span>
<span class="va">cell_abs</span> <span class="op">&lt;-</span> <span class="fu">rcoleo</span><span class="fu">::</span><span class="fu"><a href="../reference/COLEO_comp.html">COLEO_comp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">camp</span><span class="op">$</span><span class="va">cell_code</span><span class="op">)</span>,
                               <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">cells</span><span class="op">$</span><span class="va">cell_code</span><span class="op">)</span><span class="op">)</span>
<span class="va">cell_abs</span></code></pre></div>
<p>La sortie R vous indique si vous pouvez passer à l’étape suivante ou non. Dans le cas où certaines cellules n’existent pas dans Coléo, il sera nécessaire de les importer avant de continuer l’insertions des nouvelles campagnes. Pour ce faire, vous pouvez utiliser l’objet <code>cell_abs</code> que vous venez de créer et qui contient la liste des cellules à injecter dans Coléo. Suivez les étapes détaillées en déroulant la vignette <strong>Injection des cellules</strong> ci-dessous.</p>
<script>
function myFunction1() {
    var x = document.getElementById("myDIV_cells");
    if (x.style.display === "none") {
        x.style.display = "block";
    } else {
        x.style.display = "none";
    }
}
</script><div id="myDIV_cells">
<h5 id="cette-étape-permet-denregistrer-un-objet-dans-r-avec-les-informations-de-toutes-les-cellules-existantes." class="hasAnchor">
<a href="#myDIV_cells" class="anchor"></a><strong>7.3.1.1.</strong> Cette étape permet d’enregistrer un objet dans R avec les informations de toutes les cellules existantes.</h5>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">shp_cells</span> <span class="op">&lt;-</span> <span class="fu">rgdal</span><span class="fu">::</span><span class="fu">readOGR</span><span class="op">(</span>dsn<span class="op">=</span><span class="st">"./shp"</span>,
                            layer<span class="op">=</span><span class="st">"Cellule_terrain_2016-2020"</span><span class="op">)</span> <span class="co"># Ici le fichier shapefile est placé dans un dossier shp et on appelle tous les fichiers nommés "Cellule_terrain_2016_2020"</span></code></pre></div>
<h5 id="cette-étape-permet-dextraire-les-informations-nécessaires-concernant-les-nouvelles-cellules-et-de-formater-ces-informations-de-sorte-à-pouvoir-les-insérer-dans-coléo.">
<strong>7.3.1.2.</strong> Cette étape permet d’extraire les informations nécessaires concernant les nouvelles cellules et de formater ces informations de sorte à pouvoir les insérer dans Coléo.</h5>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Création d'une liste vide pour l'objet final</span>
<span class="va">shp_cells_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">cell_abs</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>

<span class="co"># Obtention des information pour un cellule</span>
  <span class="va">shp</span> <span class="op">&lt;-</span> <span class="va">shp_cells</span><span class="op">[</span><span class="va">shp_cells</span><span class="op">$</span><span class="va">IJ</span> <span class="op">==</span> <span class="va">cell_abs</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> ,<span class="op">]</span>

<span class="co"># Création d'une liste avec les informations nécessaires pour chaque cellule</span>
  <span class="va">cells_ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
  <span class="va">cells_ls</span><span class="op">$</span><span class="va">cell_code</span> <span class="op">&lt;-</span> <span class="va">cell_abs</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="co"># Code de la cellule</span>
  <span class="va">cells_ls</span><span class="op">$</span><span class="va">name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">shp_cells</span><span class="op">[</span><span class="va">shp_cells</span><span class="op">$</span><span class="va">IJ</span> <span class="op">==</span> <span class="va">cell_abs</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">shp_cells</span><span class="op">$</span><span class="va">Nom</span><span class="op">)</span>,<span class="op">]</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">Nom</span><span class="op">)</span> <span class="co"># Nom de la cellule</span>

  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">cells_ls</span><span class="op">$</span><span class="va">name</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html">character</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  
    <span class="va">cells_ls</span><span class="op">$</span><span class="va">name</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
    
  <span class="op">}</span> <span class="co"># Information absente si pas de nom pour la cellule</span>

<span class="co"># Création de l'objet spatial pour les coordonnées de la cellule</span>
  <span class="va">shp_sp</span> <span class="op">&lt;-</span> <span class="fu">as</span><span class="op">(</span><span class="va">shp</span>, <span class="st">"SpatialPolygons"</span><span class="op">)</span>
  <span class="va">cells_ls</span><span class="op">$</span><span class="va">geom</span> <span class="op">&lt;-</span> <span class="fu">geojsonio</span><span class="fu">::</span><span class="fu">geojson_list</span><span class="op">(</span><span class="va">shp</span><span class="op">)</span><span class="op">$</span><span class="va">features</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">geometry</span> <span class="co"># Caractéristiques de l'objet spatial</span>
  <span class="va">cells_ls</span><span class="op">$</span><span class="va">geom</span><span class="op">$</span><span class="va">crs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"name"</span>,
                            properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"EPSG:4326"</span><span class="op">)</span><span class="op">)</span> <span class="co"># Information sur le systême de coordonnées de référence (CRS)</span>

<span class="co"># Alimentation de l'objet final avec un niveau pour chaque cellule</span>
  <span class="va">shp_cells_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">cells_ls</span>
<span class="op">}</span></code></pre></div>
<h5 id="nous-pouvons-maintenant-insérer-les-nouvelles-cellules-dans-la-base-de-données-coléo.">
<strong>7.3.1.3.</strong> Nous pouvons maintenant insérer les nouvelles cellules dans la base de données Coléo.</h5>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Envoi de la liste de nouvelles cellules vers Coléo</span>
<span class="va">COLEO_cells</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/post_cells.html">post_cells</a></span><span class="op">(</span><span class="va">shp_cells_list</span><span class="op">)</span></code></pre></div>
<p>La sortie R vous informe sur le déroulement de l’insertion. Le message <code>Good job ! Toutes les insertions ont été créées dans COLEO</code> indique que les informations ont bien été enregistrées dans Coléo. Dans le cas inverse, le message <code>Oups... un problème est survenu</code> apparait, suivi des codes de statut pour chaque requête d’injections (pour plus d’informations à propos des <a href="https://http.cat/">codes de statut</a>).</p>
<h5 id="attention-finissez-en-faisant-la-mise-à-jour-de-la-liste-des-cellules-présentes-dans-coléo.">
<strong>7.3.1.4.</strong> ATTENTION, finissez en faisant la mise à jour de la liste des cellules présentes dans Coléo.</h5>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Mise à jour de la liste des cellules provenant de Coléo</span>
<span class="va">cells</span> <span class="op">&lt;-</span> <span class="fu">rcoleo</span><span class="fu">::</span><span class="fu"><a href="../reference/get_cells.html">get_cells</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">cells</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="st">"rbind"</span>, <span class="va">cells</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">body</span><span class="op">)</span></code></pre></div>
</div>
<script>
document.getElementById("myDIV_cells").style.display ="none"
</script><button onclick="myFunction1()">
Vignette Injection des cellules
</button>
<p>Vous pouvez maintenant récupérer l’ID unique des cellules.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Récupération des cell_id</span>
<span class="va">camp</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">camp</span>,
                         <span class="va">cells</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"cell_code"</span><span class="op">)</span><span class="op">]</span>,
                         by <span class="op">=</span> <span class="st">"cell_code"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">camp</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">camp</span><span class="op">)</span> <span class="op">==</span> <span class="st">"id"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"cell_id"</span></code></pre></div>
</div>
<div id="pour-les-sites" class="section level4">
<h4 class="hasAnchor">
<a href="#pour-les-sites" class="anchor"></a>7.3.2. Pour les sites</h4>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 7.3.2. Vérification</span>
<span class="co"># Test pour vérifier l'existence des sites dans Coléo</span>
<span class="va">site_abs</span> <span class="op">&lt;-</span> <span class="fu">rcoleo</span><span class="fu">::</span><span class="fu"><a href="../reference/COLEO_comp.html">COLEO_comp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">camp</span><span class="op">$</span><span class="va">site_code</span><span class="op">)</span>,
                               <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">sites</span><span class="op">$</span><span class="va">site_code</span><span class="op">)</span><span class="op">)</span>
<span class="va">site_abs</span></code></pre></div>
<p>La sortie R vous indique si vous pouvez passer à l’étape suivante ou non. Dans le cas où certaines cellules n’existent pas dans Coléo, il sera nécessaire de les importer avant de continuer l’insertions des nouvelles campagnes. Pour ce faire, vous pouvez utiliser l’objet <code>site_abs</code> que vous venez de créer et qui contient la liste des sites à injecter dans Coléo. Suivez les étapes détaillées en déroulant la vignette <strong>Injection des sites</strong> ci-dessous.</p>
<script>
function myFunction2() {
    var x = document.getElementById("myDIV_sites");
    if (x.style.display === "none") {
        x.style.display = "block";
    } else {
        x.style.display = "none";
    }
}
</script><div id="myDIV_sites">
<h5 id="cette-étape-permet-de-sélectionner-les-informations-nécessaires-pour-les-sites-absents-de-coléo." class="hasAnchor">
<a href="#myDIV_sites" class="anchor"></a><strong>7.3.2.1.</strong> Cette étape permet de sélectionner les informations nécessaires pour les sites absents de Coléo.</h5>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Sélection des lignes du tableau concernant les sites manquants</span>
<span class="va">site_df</span> <span class="op">&lt;-</span> <span class="va">camp</span><span class="op">[</span><span class="va">camp</span><span class="op">$</span><span class="va">site_code</span> <span class="op">%in%</span> <span class="va">site_abs</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cell_id"</span>, <span class="st">"site_code"</span>, <span class="st">"type_hab"</span>, <span class="st">"opened_at"</span>, <span class="st">"lat"</span>, <span class="st">"lon"</span><span class="op">)</span><span class="op">]</span>

<span class="co"># Retrait des lignes dupliquées</span>
<span class="va">site_df</span> <span class="op">&lt;-</span> <span class="va">site_df</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="va">site_df</span><span class="op">)</span>,<span class="op">]</span>

<span class="co"># Changement du nom de la variable "type_hab" pour correspondre à celle de Coléo ("type")</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">site_df</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">site_df</span><span class="op">)</span> <span class="op">==</span> <span class="st">"type_hab"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"type"</span>

<span class="co"># Création de la variable geom à partir des variables "lat" &amp; "lon"</span>
<span class="va">site_df_ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">site_df</span>, <span class="fl">1</span>, <span class="va">as.list</span><span class="op">)</span> <span class="co"># Création de la liste</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">site_df_ls</span><span class="op">)</span> <span class="co"># Vérification de la structure de l'objet</span>

<span class="va">geom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">site_df</span>,<span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>

  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="st">"lat"</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="st">"lon"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  
    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu">geojsonio</span><span class="fu">::</span><span class="fu">geojson_list</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="st">"lon"</span><span class="op">]</span>, <span class="va">x</span><span class="op">[</span><span class="st">"lat"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">features</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">geometry</span><span class="op">)</span>
    
  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
  
    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>
    
  <span class="op">}</span><span class="op">}</span><span class="op">)</span>

<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">site_df_ls</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="co"># Fusionner les deux listes (geomations + sites)</span>

  <span class="va">site_df_ls</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">geom</span> <span class="op">&lt;-</span> <span class="va">geom</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">is.list</a></span><span class="op">(</span><span class="va">site_df_ls</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">geom</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  
    <span class="va">site_df_ls</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">geom</span><span class="op">$</span><span class="va">crs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"name"</span>,
                                     properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"EPSG:4326"</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<h5 id="nous-pouvons-maintenant-insérer-les-nouveaux-sites-dans-la-base-de-données-coléo.">
<strong>7.3.2.2.</strong> Nous pouvons maintenant insérer les nouveaux sites dans la base de données Coléo.</h5>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Envoi de la liste des nouveaux sites vers Coléo</span>
<span class="va">COLEO_sites</span> <span class="op">&lt;-</span> <span class="fu">rcoleo</span><span class="fu">::</span><span class="fu"><a href="../reference/post_sites.html">post_sites</a></span><span class="op">(</span><span class="va">site_df_ls</span><span class="op">)</span></code></pre></div>
<p>La sortie R vous informe sur le déroulement de l’insertion. Le message <code>Good job ! Toutes les insertions ont été créées dans COLEO</code> indique que les informations ont bien été enregistrées dans Coléo. Dans le cas inverse, le message <code>Oups... un problème est survenu</code> apparait, suivi des codes de statut pour chaque requête d’injections (pour plus d’informations à propos des <a href="https://http.cat/">codes de statut</a>).</p>
<h5 id="attention-finissez-en-faisant-la-mise-à-jour-de-la-liste-des-sites-présents-dans-coléo.">
<strong>7.3.2.3.</strong> ATTENTION, finissez en faisant la mise à jour de la liste des sites présents dans Coléo.</h5>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Mise à jour de la liste des sites provenant de Coléo</span>
<span class="va">sites</span> <span class="op">&lt;-</span> <span class="fu">rcoleo</span><span class="fu">::</span><span class="fu"><a href="../reference/get_sites.html">get_sites</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">sites</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="st">"rbind"</span>, <span class="va">sites</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">body</span><span class="op">)</span></code></pre></div>
</div>
<script>
document.getElementById("myDIV_sites").style.display ="none"
</script><button onclick="myFunction2()">
Vignette Injection des sites
</button>
<p>Vous pouvez maintenant récupérer l’ID unique des sites.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Récupération des site_id</span>
<span class="va">camp</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">camp</span>,
                         <span class="va">sites</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"site_code"</span><span class="op">)</span><span class="op">]</span>,
                         by <span class="op">=</span> <span class="st">"site_code"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">camp</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">camp</span><span class="op">)</span> <span class="op">==</span> <span class="st">"id"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"site_id"</span></code></pre></div>
</div>
<div id="pour-les-noms-despèces" class="section level4">
<h4 class="hasAnchor">
<a href="#pour-les-noms-desp%C3%A8ces" class="anchor"></a>7.3.3. Pour les noms d’espèces</h4>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 7.3.3. Vérification</span>
<span class="co"># Test pour vérifier l'existence des noms des espèces dans Coléo</span>
<span class="va">sp_abs</span> <span class="op">&lt;-</span> <span class="fu">rcoleo</span><span class="fu">::</span><span class="fu"><a href="../reference/COLEO_comp.html">COLEO_comp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">camp</span><span class="op">$</span><span class="va">taxa_name</span><span class="op">)</span>,
                             <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">species</span><span class="op">$</span><span class="va">name</span><span class="op">)</span><span class="op">)</span>
<span class="va">sp_abs</span></code></pre></div>
<p>La sortie R vous indique si vous pouvez passer à l’étape suivante ou non. Dans le cas où certaines cellules n’existent pas dans Coléo, il sera nécessaire de les importer avant de continuer l’insertions des nouvelles campagnes. Pour ce faire, vous pouvez utiliser l’objet <code>sp_abs</code> que vous venez de créer et qui contient la liste des noms d’espèces à injecter dans Coléo. Suivez les étapes détaillées en déroulant la vignette <strong>Injection des noms d’espèces</strong> ci-dessous.</p>
<script>
function myFunction3() {
    var x = document.getElementById("myDIV_taxa");
    if (x.style.display === "none") {
        x.style.display = "block";
    } else {
        x.style.display = "none";
    }
}
</script><div id="myDIV_taxa">
<h5 id="cette-étape-permet-de-sélectionner-les-informations-nécessaires-pour-les-noms-despèce-absents-de-coléo." class="hasAnchor">
<a href="#myDIV_taxa" class="anchor"></a><strong>7.3.3.1.</strong> Cette étape permet de sélectionner les informations nécessaires pour les noms d’espèce absents de Coléo.</h5>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Formatage du tableau à insérer</span>
<span class="va">taxa_df</span> <span class="op">&lt;-</span> <span class="va">camp</span><span class="op">[</span><span class="va">camp</span><span class="op">$</span><span class="va">taxa_name</span> <span class="op">%in%</span> <span class="va">sp_abs</span>,<span class="op">]</span>
<span class="va">taxa_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">taxa_df</span>,
                    name <span class="op">=</span> <span class="va">taxa_name</span>,
                    <span class="va">vernacular_fr</span><span class="op">)</span> <span class="co"># colonnes nécessaires</span></code></pre></div>
<h5 id="cette-étape-permet-de-formatter-les-données-afin-de-pouvoir-les-injecter-dans-la-base-de-données-coléo.">
<strong>7.3.3.2.</strong> Cette étape permet de formatter les données afin de pouvoir les injecter dans la base de données Coléo.</h5>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Retrait des lignes dupliquées</span>
<span class="va">taxa_df</span> <span class="op">&lt;-</span> <span class="va">taxa_df</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="va">taxa_df</span><span class="op">)</span>,<span class="op">]</span> 

<span class="co"># Formatage des données sous forme de liste</span>
<span class="va">taxa_df_ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">taxa_df</span>, <span class="fl">1</span>, <span class="va">as.list</span><span class="op">)</span></code></pre></div>
<h5 id="on-injecte-dans-la-base-de-données-coléo.">
<strong>7.3.3.3.</strong> On injecte dans la base de données Coléo.</h5>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Injection</span>
<span class="va">COLEO_taxa</span> <span class="op">&lt;-</span> <span class="fu">rcoleo</span><span class="fu">::</span><span class="fu"><a href="../reference/post_species.html">post_species</a></span><span class="op">(</span><span class="va">taxa_df_ls</span><span class="op">)</span></code></pre></div>
<p><strong><em>ATTENTION</em></strong> Réfléchir au fait que toutes les informations pour les espèces ne sont pas renseignées avec cette méthode</p>
</div>
<script>
document.getElementById("myDIV_taxa").style.display ="none"
</script><button onclick="myFunction3()">
Vignette injection noms d’espèce
</button>
</div>
<div id="pour-les-attributs" class="section level4">
<h4 class="hasAnchor">
<a href="#pour-les-attributs" class="anchor"></a>7.3.4. Pour les attributs</h4>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 7.3.4. Vérification</span>
<span class="co"># Contenu de la table des attributs dans Coléo</span>
<span class="va">attrs</span></code></pre></div>
<p>Vous pouvez vérifier si les attributs nécessaires à vos campagnes sont bien présents dans cette table.</p>
</div>
</div>
</div>
<div id="injection-des-campagnes-de-papillons" class="section level2">
<h2 class="hasAnchor">
<a href="#injection-des-campagnes-de-papillons" class="anchor"></a>8. Injection des campagnes de papillons</h2>
<p>Pour une injection complète d’une campagne, il est nécessaire de passer par l’importation d’informations successives dans différentes tables de Coléo. La hiérarchie des tables à renseigner est cruciale, sans quoi l’injection de la campagne est vouée à l’échec. Les prochaines étapes détaillent l’ajout d’information dans les tables:</p>
<ol style="list-style-type: decimal">
<li>Campagnes (“<em>/campaigns</em>”)</li>
<li>Repères (“<em>/landmarks</em>”)</li>
<li>Efforts (“<em>/efforts</em>”)</li>
<li>Environnements (“<em>/environment</em>”)</li>
<li>Observations (“<em>/observations</em>”)</li>
<li>Observations des espèces (“<em>/obs_species</em>”)</li>
</ol>
<div id="injections-des-informations-sur-les-nouvelles-campagnes" class="section level3">
<h3 class="hasAnchor">
<a href="#injections-des-informations-sur-les-nouvelles-campagnes" class="anchor"></a>8.1. Injections des informations sur les nouvelles campagnes</h3>
<p>Les champs de la table <strong>campagnes</strong> (“/campaigns”) de Coléo qui seront remplis sont les suivants :</p>
<ul>
<li><em>site_id</em></li>
<li>
<em>type</em>: type de la campagne</li>
<li>
<em>technicians</em>: liste composée de “technician_1” et “technician_2”</li>
<li><em>opened_at</em></li>
<li><em>closed_at</em></li>
</ul>
<div id="on-commence-par-séléctionner-les-champs-dinterêts-" class="section level4">
<h4 class="hasAnchor">
<a href="#on-commence-par-s%C3%A9l%C3%A9ctionner-les-champs-dinter%C3%AAts-" class="anchor"></a>8.1.1. On commence par séléctionner les champs d’interêts.</h4>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 8.1.1. Sélection</span>
<span class="va">camp_camp</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">camp</span>,
                          <span class="va">site_id</span>,
                          <span class="va">type</span>,
                          <span class="va">technician_1</span>,
                          <span class="va">technician_2</span>,
                          <span class="va">opened_at</span>,
                          <span class="va">closed_at</span><span class="op">)</span></code></pre></div>
</div>
<div id="on-garde-une-ligne-unique-par-nouvelle-campagne-" class="section level4">
<h4 class="hasAnchor">
<a href="#on-garde-une-ligne-unique-par-nouvelle-campagne-" class="anchor"></a>8.1.2. On garde une ligne unique par nouvelle campagne.</h4>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 8.1.2. Retrait des duplicat</span>
<span class="va">camp_camp</span> <span class="op">&lt;-</span> <span class="va">camp_camp</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="va">camp_camp</span><span class="op">)</span>,<span class="op">]</span></code></pre></div>
</div>
<div id="on-créé-la-liste-pour-le-nom-des-techniciens-" class="section level4">
<h4 class="hasAnchor">
<a href="#on-cr%C3%A9%C3%A9-la-liste-pour-le-nom-des-techniciens-" class="anchor"></a>8.1.3. On créé la liste pour le nom des techniciens.</h4>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 8.1.3. Création liste de technicien.ne.s</span>
<span class="va">tech</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># Création d'un objet `list` vide</span>

<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">camp_camp</span><span class="op">$</span><span class="va">site_id</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>

  <span class="va">tech</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">camp_camp</span><span class="op">$</span><span class="va">technician_1</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,
                    <span class="va">camp_camp</span><span class="op">$</span><span class="va">technician_2</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
                    
<span class="op">}</span> <span class="co"># Chaque niveau de la liste correspond à une association des deux noms des technicien/ne/s pour chaque ligne du tableau</span>

<span class="va">camp_camp</span><span class="op">$</span><span class="va">technicians</span> <span class="op">&lt;-</span> <span class="va">tech</span> <span class="co"># Ajout de la liste au tableau à injecter dans Coléo</span></code></pre></div>
</div>
<div id="on-transforme-le-tableau-en-liste-pour-pouvoir-injecter-les-données-dans-coléo-" class="section level4">
<h4 class="hasAnchor">
<a href="#on-transforme-le-tableau-en-liste-pour-pouvoir-injecter-les-donn%C3%A9es-dans-col%C3%A9o-" class="anchor"></a>8.1.4. On transforme le tableau en liste pour pouvoir injecter les données dans Coléo.</h4>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 8.1.4. Conversion de l'objet pour l'injection</span>
<span class="va">camp_ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">camp_camp</span>, <span class="fl">1</span>, <span class="va">as.list</span><span class="op">)</span></code></pre></div>
</div>
<div id="on-injecte-" class="section level4">
<h4 class="hasAnchor">
<a href="#on-injecte-" class="anchor"></a>8.1.5. On injecte.</h4>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 8.1.5. Injection</span>
<span class="va">COLEO_camp_inj</span> <span class="op">&lt;-</span> <span class="fu">rcoleo</span><span class="fu">::</span><span class="fu"><a href="../reference/post_campaigns.html">post_campaigns</a></span><span class="op">(</span><span class="va">camp_ls</span><span class="op">)</span> </code></pre></div>
<p>La sortie R vous informe sur le déroulement de l’insertion. Le message <code>Good job ! Toutes les insertions ont été créées dans COLEO</code> indique que les informations ont bien été enregistrées dans Coléo. Dans le cas inverse, le message <code>Oups... un problème est survenu</code> apparait, suivi des codes de statut pour chaque requête d’injections (pour plus d’informations à propos des <a href="https://http.cat/">codes de statut</a>).</p>
</div>
<div id="on-récupère-la-liste-de-campagnes-provenant-de-coléo-" class="section level4">
<h4 class="hasAnchor">
<a href="#on-r%C3%A9cup%C3%A8re-la-liste-de-campagnes-provenant-de-col%C3%A9o-" class="anchor"></a>8.1.6. On récupère la liste de campagnes provenant de Coléo.</h4>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 8.1.6. Liste des campagnes</span>
<span class="va">campaigns</span> <span class="op">&lt;-</span> <span class="fu">rcoleo</span><span class="fu">::</span><span class="fu"><a href="../reference/get_campaigns.html">get_campaigns</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">campaigns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind.fill</span>, <span class="va">campaigns</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">body</span><span class="op">)</span></code></pre></div>
</div>
<div id="on-récupère-le-id-unique-pour-chaque-campagne-nouvellement-insérées-" class="section level4">
<h4 class="hasAnchor">
<a href="#on-r%C3%A9cup%C3%A8re-le-id-unique-pour-chaque-campagne-nouvellement-ins%C3%A9r%C3%A9es-" class="anchor"></a>8.1.7. On récupère le id unique pour chaque campagne nouvellement insérées.</h4>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 8.1.7. Récupération des IDs des campagnes</span>
<span class="va">camp</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">camp</span>,
                         <span class="va">campaigns</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"site_id"</span>, <span class="st">"opened_at"</span>, <span class="st">"type"</span><span class="op">)</span><span class="op">]</span>,
                         by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"site_id"</span>, <span class="st">"opened_at"</span>, <span class="st">"type"</span><span class="op">)</span><span class="op">)</span>
                         
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">camp</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">camp</span><span class="op">)</span> <span class="op">==</span> <span class="st">"id"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"campaign_id"</span></code></pre></div>
</div>
</div>
<div id="injections-des-repères-associés-aux-nouvelles-campagnes" class="section level3">
<h3 class="hasAnchor">
<a href="#injections-des-rep%C3%A8res-associ%C3%A9s-aux-nouvelles-campagnes" class="anchor"></a>8.2. Injections des repères associés aux nouvelles campagnes</h3>
<p>Les champs de la table <strong>repères</strong> (“/landmarks”) de Coléo qui peuvent être remplis sont les suivants : * <em>campaign_id</em> * <em>geom</em></p>
<div id="on-commence-par-séléctionner-les-champs-dinterêts--1" class="section level4">
<h4 class="hasAnchor">
<a href="#on-commence-par-s%C3%A9l%C3%A9ctionner-les-champs-dinter%C3%AAts--1" class="anchor"></a>8.2.1. On commence par séléctionner les champs d’interêts.</h4>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 8.2.1. Sélection</span>
<span class="va">land_camp</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">camp</span>,
                           <span class="va">campaign_id</span>,
                           <span class="va">lat</span>,
                           <span class="va">lon</span><span class="op">)</span></code></pre></div>
</div>
<div id="on-garde-une-ligne-par-repère-cest-à-dire-par-campagne-" class="section level4">
<h4 class="hasAnchor">
<a href="#on-garde-une-ligne-par-rep%C3%A8re-cest-%C3%A0-dire-par-campagne-" class="anchor"></a>8.2.2. On garde une ligne par repère (c’est-à-dire par campagne).</h4>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 8.2.2. Retrait des duplicats</span>
<span class="va">land_camp</span> <span class="op">&lt;-</span> <span class="va">land_camp</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="va">land_camp</span><span class="op">)</span>,<span class="op">]</span></code></pre></div>
</div>
<div id="on-transforme-le-tableau-en-liste-pour-pouvoir-linjecter-dans-coléo-" class="section level4">
<h4 class="hasAnchor">
<a href="#on-transforme-le-tableau-en-liste-pour-pouvoir-linjecter-dans-col%C3%A9o-" class="anchor"></a>8.2.3. On transforme le tableau en liste pour pouvoir l’injecter dans Coléo.</h4>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 8.2.3. Conversion de l'objet pour l'injection</span>
<span class="va">land_ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">land_camp</span>, <span class="fl">1</span>, <span class="va">as.list</span><span class="op">)</span></code></pre></div>
</div>
<div id="on-créé-le-champs-geom-de-coléo-sous-forme-de-liste-en-utilisant-les-variables-lat-lon-du-tableau-" class="section level4">
<h4 class="hasAnchor">
<a href="#on-cr%C3%A9%C3%A9-le-champs-geom-de-col%C3%A9o-sous-forme-de-liste-en-utilisant-les-variables-lat-lon-du-tableau-" class="anchor"></a>8.2.4. On créé le champs <code>geom</code> de Coléo, sous forme de liste, en utilisant les variables <em>lat</em> &amp; <em>lon</em> du tableau.</h4>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 8.2.4. Création de la variable `geom`</span>
<span class="va">geom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">land_camp</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>

<span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="st">"lat"</span><span class="op">]</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="st">"lon"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>

  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu">geojsonio</span><span class="fu">::</span><span class="fu">geojson_list</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="st">"lon"</span><span class="op">]</span>,<span class="va">x</span><span class="op">[</span><span class="st">"lat"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">features</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">geometry</span><span class="op">)</span>
  
<span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>

  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>
  
<span class="op">}</span><span class="op">}</span><span class="op">)</span></code></pre></div>
</div>
<div id="on-fusionne-les-deux-listes-en-prévision-de-linjection-dans-coléo-" class="section level4">
<h4 class="hasAnchor">
<a href="#on-fusionne-les-deux-listes-en-pr%C3%A9vision-de-linjection-dans-col%C3%A9o-" class="anchor"></a>8.2.5. On fusionne les deux listes en prévision de l’injection dans Coléo.</h4>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 8.2.5. Fusion des listes</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">land_ls</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>

 <span class="va">land_ls</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">geom</span> <span class="op">&lt;-</span> <span class="va">geom</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
 
 <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">is.list</a></span><span class="op">(</span><span class="va">land_ls</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">geom</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
 
   <span class="va">land_ls</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">geom</span><span class="op">$</span><span class="va">crs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"name"</span>,properties<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"EPSG:4326"</span><span class="op">)</span><span class="op">)</span>
   
 <span class="op">}</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="il-est-maintenant-possible-de-procéder-à-linjection-" class="section level4">
<h4 class="hasAnchor">
<a href="#il-est-maintenant-possible-de-proc%C3%A9der-%C3%A0-linjection-" class="anchor"></a>8.2.6. Il est maintenant possible de procéder à l’injection.</h4>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 8.2.6. Injection</span>
<span class="va">COLEO_land_inj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/post_landmarks.html">post_landmarks</a></span><span class="op">(</span><span class="va">land_ls</span><span class="op">)</span></code></pre></div>
<p>La sortie R vous informe sur le déroulement de l’insertion. Le message <code>Good job ! Toutes les insertions ont été créées dans COLEO</code> indique que les informations ont bien été enregistrées dans Coléo. Dans le cas inverse, le message <code>Oups... un problème est survenu</code> apparait, suivi des codes de statut pour chaque requête d’injections (pour plus d’informations à propos des <a href="https://http.cat/">codes de statut</a>).</p>
</div>
</div>
<div id="injections-des-caractéristiques-environnementales" class="section level3">
<h3 class="hasAnchor">
<a href="#injections-des-caract%C3%A9ristiques-environnementales" class="anchor"></a>8.3. Injections des caractéristiques environnementales</h3>
<p>Les champs de la table <strong>environnement</strong> (“/environment”) de Coléo qui peuvent être remplis sont les suivants :</p>
<ul>
<li><em>campaign_id</em></li>
<li><em>wind</em></li>
<li><em>sky</em></li>
<li><em>temp_c</em></li>
</ul>
<div id="on-commence-par-séléctionner-les-champs-dinterêts--2" class="section level4">
<h4 class="hasAnchor">
<a href="#on-commence-par-s%C3%A9l%C3%A9ctionner-les-champs-dinter%C3%AAts--2" class="anchor"></a>8.3.1. On commence par séléctionner les champs d’interêts.</h4>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 8.3.1. Sélection</span>
<span class="va">env_camp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">camp</span>,
                  <span class="va">campaign_id</span>,
                  <span class="va">wind</span>,
                  <span class="va">sky</span>,
                  <span class="va">temp_c</span><span class="op">)</span></code></pre></div>
</div>
<div id="on-garde-une-ligne-par-campagne-" class="section level4">
<h4 class="hasAnchor">
<a href="#on-garde-une-ligne-par-campagne-" class="anchor"></a>8.3.2. On garde une ligne par campagne.</h4>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 8.3.2. Retrait des duplicats</span>
<span class="va">env_camp</span> <span class="op">&lt;-</span> <span class="va">env_camp</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="va">env_camp</span><span class="op">)</span>,<span class="op">]</span></code></pre></div>
</div>
<div id="on-transforme-en-liste-" class="section level4">
<h4 class="hasAnchor">
<a href="#on-transforme-en-liste-" class="anchor"></a>8.3.3. On transforme en liste.</h4>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 8.3.3. Conversion de l'objet pour l'injection</span>
<span class="va">env_camp_ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">env_camp</span>, <span class="fl">1</span>, <span class="va">as.list</span><span class="op">)</span></code></pre></div>
</div>
<div id="on-injecte--1" class="section level4">
<h4 class="hasAnchor">
<a href="#on-injecte--1" class="anchor"></a>8.3.4. On injecte.</h4>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 8.3.4. Injection</span>
<span class="va">COLEO_env_inj</span> <span class="op">&lt;-</span> <span class="fu">rcoleo</span><span class="fu">::</span><span class="fu"><a href="../reference/post_environments.html">post_environments</a></span><span class="op">(</span><span class="va">env_camp_ls</span><span class="op">)</span></code></pre></div>
<p>La sortie R vous informe sur le déroulement de l’insertion. Le message <code>Good job ! Toutes les insertions ont été créées dans COLEO</code> indique que les informations ont bien été enregistrées dans Coléo. Dans le cas inverse, le message <code>Oups... un problème est survenu</code> apparait, suivi des codes de statut pour chaque requête d’injections (pour plus d’informations à propos des <a href="https://http.cat/">codes de statut</a>).</p>
</div>
</div>
<div id="injections-des-efforts" class="section level3">
<h3 class="hasAnchor">
<a href="#injections-des-efforts" class="anchor"></a>8.4. Injections des efforts</h3>
<p>Les champs de la table <strong>efforts</strong> (“/efforts”) de Coléo qui peuvent être remplis sont les suivants :</p>
<ul>
<li><em>campaign_id</em></li>
<li><em>time_start</em></li>
<li><em>time_finish</em></li>
</ul>
<div id="on-sélectionne-les-champs-dintérêts-" class="section level4">
<h4 class="hasAnchor">
<a href="#on-s%C3%A9lectionne-les-champs-dint%C3%A9r%C3%AAts-" class="anchor"></a>8.4.1. On sélectionne les champs d’intérêts.</h4>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 8.4.1. Sélection</span>
<span class="va">eff_camp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">camp</span>,
                   <span class="va">campaign_id</span>,
                   <span class="va">time_start</span>,
                   <span class="va">time_finish</span><span class="op">)</span></code></pre></div>
</div>
<div id="on-garde-une-ligne-par-campagne--1" class="section level4">
<h4 class="hasAnchor">
<a href="#on-garde-une-ligne-par-campagne--1" class="anchor"></a>8.4.2. On garde une ligne par campagne.</h4>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 8.4.2. Retrait des duplicats</span>
<span class="va">eff_camp</span> <span class="op">&lt;-</span> <span class="va">eff_camp</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="va">eff_camp</span><span class="op">)</span>,<span class="op">]</span></code></pre></div>
</div>
<div id="on-transforme-en-liste--1" class="section level4">
<h4 class="hasAnchor">
<a href="#on-transforme-en-liste--1" class="anchor"></a>8.4.3. On transforme en liste.</h4>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 8.4.3. Conversion de l'objet pour l'injection</span>
<span class="va">eff_camp_ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">eff_camp</span>, <span class="fl">1</span>, <span class="va">as.list</span><span class="op">)</span></code></pre></div>
</div>
<div id="on-injecte--2" class="section level4">
<h4 class="hasAnchor">
<a href="#on-injecte--2" class="anchor"></a>8.4.4. On injecte.</h4>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 8.4.4. Injection</span>
<span class="va">COLEO_eff_inj</span> <span class="op">&lt;-</span> <span class="fu">rcoleo</span><span class="fu">::</span><span class="fu"><a href="../reference/post_efforts.html">post_efforts</a></span><span class="op">(</span><span class="va">eff_camp_ls</span><span class="op">)</span> </code></pre></div>
<p>La sortie R vous informe sur le déroulement de l’insertion. Le message <code>Good job ! Toutes les insertions ont été créées dans COLEO</code> indique que les informations ont bien été enregistrées dans Coléo. Dans le cas inverse, le message <code>Oups... un problème est survenu</code> apparait, suivi des codes de statut pour chaque requête d’injections (pour plus d’informations à propos des <a href="https://http.cat/">codes de statut</a>).</p>
</div>
</div>
<div id="insertion-des-observations" class="section level3">
<h3 class="hasAnchor">
<a href="#insertion-des-observations" class="anchor"></a>8.5. Insertion des observations</h3>
<p>Les champs de la table <strong>observations</strong> (“/observations”) de Coléo qui peuvent être remplis sont les suivants :</p>
<ul>
<li><em>campaign_id</em></li>
<li>
<em>is_valid</em> : 1 par défaut</li>
<li><em>date_obs</em></li>
</ul>
<div id="on-sélectionne-les-champs-dintérêts--1" class="section level4">
<h4 class="hasAnchor">
<a href="#on-s%C3%A9lectionne-les-champs-dint%C3%A9r%C3%AAts--1" class="anchor"></a>8.5.1. On sélectionne les champs d’intérêts.</h4>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 8.5.1. Création &amp; sélection</span>
<span class="co"># Création de 2 variables nécessaires</span>
<span class="va">camp</span><span class="op">$</span><span class="va">date_obs</span> <span class="op">&lt;-</span> <span class="va">camp</span><span class="op">$</span><span class="va">opened_at</span>
<span class="va">camp</span><span class="op">$</span><span class="va">is_valid</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="co"># valeur de 1 par défaut</span>

<span class="co"># On sélectionne les champs d'intérêts.</span>
<span class="va">obs_camp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">camp</span>,
                   <span class="va">date_obs</span>,
                   <span class="va">is_valid</span>,
                   notes <span class="op">=</span> <span class="va">note</span>,
                   <span class="va">campaign_id</span><span class="op">)</span></code></pre></div>
</div>
<div id="on-garde-une-ligne-par-campagne--2" class="section level4">
<h4 class="hasAnchor">
<a href="#on-garde-une-ligne-par-campagne--2" class="anchor"></a>8.5.2. On garde une ligne par campagne.</h4>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 8.5.2. Retrait des duplicats</span>
<span class="va">obs_camp</span> <span class="op">&lt;-</span> <span class="va">obs_camp</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="va">obs_camp</span><span class="op">)</span>,<span class="op">]</span></code></pre></div>
</div>
<div id="on-formatte-les-données-à-insérer-" class="section level4">
<h4 class="hasAnchor">
<a href="#on-formatte-les-donn%C3%A9es-%C3%A0-ins%C3%A9rer-" class="anchor"></a>8.5.3. On formatte les données à insérer.</h4>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 8.5.3. Conversion de l'objet pour l'insertion</span>
<span class="va">obs_camp_ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">obs_camp</span>, <span class="fl">1</span>, <span class="va">as.list</span><span class="op">)</span></code></pre></div>
</div>
<div id="on-injecte--3" class="section level4">
<h4 class="hasAnchor">
<a href="#on-injecte--3" class="anchor"></a>8.5.4. On injecte.</h4>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 8.5.4. Injection</span>
<span class="va">COLEO_obs_inj</span> <span class="op">&lt;-</span> <span class="fu">rcoleo</span><span class="fu">::</span><span class="fu"><a href="../reference/post_obs.html">post_obs</a></span><span class="op">(</span><span class="va">obs_camp_ls</span><span class="op">)</span></code></pre></div>
<p>La sortie R vous informe sur le déroulement de l’insertion. Le message <code>Good job ! Toutes les insertions ont été créées dans COLEO</code> indique que les informations ont bien été enregistrées dans Coléo. Dans le cas inverse, le message <code>Oups... un problème est survenu</code> apparait, suivi des codes de statut pour chaque requête d’injections (pour plus d’informations à propos des <a href="https://http.cat/">codes de statut</a>).</p>
</div>
<div id="on-récupère-la-liste-des-observations-de-coléo-et-on-met-à-jour-le-tableau-de-campagnes-à-injecter-" class="section level4">
<h4 class="hasAnchor">
<a href="#on-r%C3%A9cup%C3%A8re-la-liste-des-observations-de-col%C3%A9o-et-on-met-%C3%A0-jour-le-tableau-de-campagnes-%C3%A0-injecter-" class="anchor"></a>8.5.5. On récupère la liste des observations de Coléo et on met à jour le tableau de campagnes à injecter.</h4>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 8.5.5. Acquisition de la liste d'observations de Coléo</span>
<span class="va">obs</span> <span class="op">&lt;-</span> <span class="fu">rcoleo</span><span class="fu">::</span><span class="fu"><a href="../reference/get_gen.html">get_gen</a></span><span class="op">(</span><span class="st">"/observations"</span><span class="op">)</span>
<span class="va">obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind.fill</span>, <span class="va">obs</span><span class="op">$</span><span class="va">body</span><span class="op">)</span>

<span class="co"># Mise à jour des données à injecter avec l'observation_id</span>
<span class="va">camp</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">camp</span>, <span class="va">obs</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"campaign_id"</span>, <span class="st">"date_obs"</span><span class="op">)</span><span class="op">]</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"campaign_id"</span>, <span class="st">"date_obs"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">camp</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">camp</span><span class="op">)</span> <span class="op">==</span> <span class="st">"id"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"observation_id"</span></code></pre></div>
</div>
</div>
<div id="injections-des-observations-despèce" class="section level3">
<h3 class="hasAnchor">
<a href="#injections-des-observations-desp%C3%A8ce" class="anchor"></a>8.6. Injections des observations d’espèce</h3>
<p>Les champs de la table <strong>observations des espèces</strong> (“/obs_species”) de Coléo qui peuvent être remplis sont les suivants :</p>
<ul>
<li><em>observation_id</em></li>
<li>
<em>taxa_name</em> : nom latin de l’espèce</li>
<li><em>variable</em></li>
<li><em>value</em></li>
</ul>
<div id="on-sélectionne-les-champs-dintérêts--2" class="section level4">
<h4 class="hasAnchor">
<a href="#on-s%C3%A9lectionne-les-champs-dint%C3%A9r%C3%AAts--2" class="anchor"></a>8.6.1. On sélectionne les champs d’intérêts.</h4>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 8.6.1. Sélection</span>
<span class="va">obs_spe_camp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">camp</span>,
                      <span class="va">observation_id</span>,
                      value <span class="op">=</span> <span class="va">abondance</span>,
                      <span class="va">taxa_name</span><span class="op">)</span>

<span class="co"># Ajout d'une variable</span>
<span class="va">obs_spe_camp</span><span class="op">$</span><span class="va">variable</span> <span class="op">&lt;-</span> <span class="st">"abondance"</span></code></pre></div>
</div>
<div id="on-formatte-les-données-à-injecter-" class="section level4">
<h4 class="hasAnchor">
<a href="#on-formatte-les-donn%C3%A9es-%C3%A0-injecter-" class="anchor"></a>8.6.2. On formatte les données à injecter.</h4>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 8.6.2. Conversion de l'objet pour l'injection</span>
<span class="va">obs_spe_camp_ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">obs_spe_camp</span>, <span class="fl">1</span>, <span class="va">as.list</span><span class="op">)</span></code></pre></div>
</div>
<div id="on-injecte--4" class="section level4">
<h4 class="hasAnchor">
<a href="#on-injecte--4" class="anchor"></a>8.6.3. On injecte.</h4>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 8.6.3. Injection</span>
<span class="va">COLEO_obsref_inj</span> <span class="op">&lt;-</span> <span class="fu">rcoleo</span><span class="fu">::</span><span class="fu"><a href="../reference/post_obs_species.html">post_obs_species</a></span><span class="op">(</span><span class="va">obs_spe_camp_ls</span><span class="op">)</span></code></pre></div>
<p>La sortie R vous informe sur le déroulement de l’insertion. Le message <code>Good job ! Toutes les insertions ont été créées dans COLEO</code> indique que les informations ont bien été enregistrées dans Coléo. Bravo ! Vous venez de terminer les étapes d’injections des campagnes <strong>papilonidés</strong> ! Dans le cas inverse, le message <code>Oups... un problème est survenu</code> apparait, suivi des codes de statut pour chaque requête d’injections (pour plus d’informations à propos des <a href="https://http.cat/">codes de statut</a>).</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Steve Vissault.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'API_KEY',
    indexName: 'INDEX_NAME',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
