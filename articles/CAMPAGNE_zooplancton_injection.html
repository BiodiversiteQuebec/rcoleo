<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tutoriel pour injection des campagnes Zooplancton • rcoleo</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Tutoriel pour injection des campagnes Zooplancton">
<meta property="og:description" content="rcoleo">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rcoleo</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://coleo.biodiversite-quebec.ca/docs/">
    <span class="fa fa-book fa-lg"></span>
     
  </a>
</li>
<li>
  <a></a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/telecharge-sites.html">Téléchargement des sites</a>
    </li>
    <li>
      <a href="../articles/injection-cellules.html">Injection des cellules</a>
    </li>
    <li>
      <a href="../articles/injection-taxa.html">Injection des noms d'espèce</a>
    </li>
    <li>
      <a href="../articles/injection-sites.html">Injecter sites</a>
    </li>
    <li>
      <a href="../articles/CAMPAGNE_zooplancton_injection.html">Injection des campagnes ZOOPLANCTON</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ReseauBiodiversiteQuebec/rcoleo">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="CAMPAGNE_zooplancton_injection_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Tutoriel pour injection des campagnes Zooplancton</h1>
                        <h4 class="author">Claire-Cécile Juhasz</h4>
            
            <h4 class="date">10 novembre 2020</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ReseauBiodiversiteQuebec/rcoleo/blob/master/vignettes/CAMPAGNE_zooplancton_injection.Rmd"><code>vignettes/CAMPAGNE_zooplancton_injection.Rmd</code></a></small>
      <div class="hidden name"><code>CAMPAGNE_zooplancton_injection.Rmd</code></div>

    </div>

    
    
<div id="créer-une-base-de-données-excel" class="section level2">
<h2 class="hasAnchor">
<a href="#cr%C3%A9er-une-base-de-donn%C3%A9es-excel" class="anchor"></a>1. Créer une base de données excel</h2>
<p>Afin d’injecter des nouvelles campagnes <em>zooplancton</em> dans la base de données Coléo, vous devez regrouper les informations suivantes dans un fichier excel :</p>
<ul>
<li><strong>nom_cellule</strong></li>
<li>
<strong>no_de_reference_de_la_cellule</strong>: code numérique unique pour chaque cellule</li>
<li>
<strong>no_de_reference_du_site</strong>: code alpha-numérique unique du site</li>
<li>
<strong>type_milieu</strong>: ‘lac’, ‘rivière’, ‘forestier’, ‘marais’, ‘marais côtier’, ‘toundrique’, ‘tourbière’</li>
<li><strong>nom_lac</strong></li>
<li>
<strong>latitude</strong>: latitude du site d’échantillonnage</li>
<li>
<strong>longitude</strong>: longitude du site d’échantillonnage</li>
<li>
<strong>date_debut</strong>: date du début du prélèvement</li>
<li>
<strong>date_fin</strong>: date de la fin du prélèvement</li>
<li><strong>technicien_1</strong></li>
<li><strong>technicien_2</strong></li>
<li>
<strong>Profondeur_m</strong>: profondeur du prélèvement</li>
<li><strong>Date_denombrement</strong></li>
<li>
<strong>nom_scientifique</strong>: nom latin des espèces observées</li>
<li><strong>abondance</strong></li>
<li><strong>Taxonomiste</strong></li>
</ul>
<p>Note : ne pas laisser de case vide, inscrire NA lorsque nécessaire</p>
</div>
<div id="corriger-la-base-de-données" class="section level2">
<h2 class="hasAnchor">
<a href="#corriger-la-base-de-donn%C3%A9es" class="anchor"></a>2. Corriger la base de données</h2>
<p>Il est très important de s’assurer que la base de données excel soit sans erreur <strong>avant</strong> de l’injecter dans Coléo. Coléo n’a pas de système de correction et va prendre toutes les entrées, même si elles contiennent des erreurs.</p>
</div>
<div id="créer-un-projet-r" class="section level2">
<h2 class="hasAnchor">
<a href="#cr%C3%A9er-un-projet-r" class="anchor"></a>3. Créer un projet R</h2>
<p>Dans RStudio,</p>
<ul>
<li>Aller dans <code>File</code> &gt; <code>New Project</code> &gt; <code>New Directory</code> &gt; <code>New Project</code>
</li>
<li>Choisir un nom de projet et un lieu dans les fichiers pour le projet</li>
</ul>
<p>Les projets permettent de travailler dans un répertoire de travail (<em>working directory</em>). La base de données doit donc être sauvegardée dans le même dossier que le projet afin de faire parti du répertoire de travail.</p>
</div>
<div id="sauvegarder-la-base-de-données-en-format--csv-dans-le-même-dossier-que-le-projet-r" class="section level2">
<h2 class="hasAnchor">
<a href="#sauvegarder-la-base-de-donn%C3%A9es-en-format--csv-dans-le-m%C3%AAme-dossier-que-le-projet-r" class="anchor"></a>4. Sauvegarder la base de données en format .csv dans le même dossier que le projet R</h2>
</div>
<div id="installer-les-packages-nécessaires" class="section level2">
<h2 class="hasAnchor">
<a href="#installer-les-packages-n%C3%A9cessaires" class="anchor"></a>5. Installer les packages nécessaires</h2>
<p>Dans RStudio,</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"dplyr"</span><span class="op">)</span></code></pre></div>
<p>Pour installer le package <code>rcoleo</code>, il faut utiliser le package <code>devtools</code>, il faut donc l’appeller avec <code><a href="https://rdrr.io/r/base/library.html">library()</a></code></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">devtools</span><span class="op">)</span>
<span class="fu">install_github</span><span class="op">(</span><span class="st">"TheoreticalEcosystemEcology/rcoleo"</span><span class="op">)</span> <span class="co"># installation du package rcoleo à partir de github</span></code></pre></div>
</div>
<div id="mettre-en-cache-son-jeton-daccès" class="section level2">
<h2 class="hasAnchor">
<a href="#mettre-en-cache-son-jeton-dacc%C3%A8s" class="anchor"></a>6. Mettre en cache son jeton d’accès</h2>
<p>Ce jeton permet d’apporter des modifications dans Coléo. Il est unique et se retrouve dans Coléo, sous le profil de l’utilisateur dans le menu à gauche.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="st">"votrejeton"</span>,<span class="st">".httr-oauth"</span><span class="op">)</span></code></pre></div>
<p>Cette étape n’est faite qu’une fois et permet l’enregistrement de votre jeton dans le répertoire du projet R. Une fois faite, elle est supprimée du code d’injection. Le jeton est confidentiel.</p>
</div>
<div id="vérification-pré-injection" class="section level2">
<h2 class="hasAnchor">
<a href="#v%C3%A9rification-pr%C3%A9-injection" class="anchor"></a>7. Vérification pré-injection</h2>
<p>La succession d’étape qui suivent permettent de vérifier si les cellules, les sites et les noms d’espèces associés aux campagnes à injecter existent déjà dans Coléo.</p>
<div id="création-dun-objet-r-avec-les-nouvelles-campagnes-à-insérer-dans-coléo" class="section level3">
<h3 class="hasAnchor">
<a href="#cr%C3%A9ation-dun-objet-r-avec-les-nouvelles-campagnes-%C3%A0-ins%C3%A9rer-dans-col%C3%A9o" class="anchor"></a>7.1. Création d’un objet R avec les nouvelles campagnes à insérer dans Coléo</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">camp_zoopl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"./lenomdevotrebasededonnées.csv"</span>, header <span class="op">=</span> <span class="cn">TRUE</span>, sep <span class="op">=</span> <span class="st">','</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span>, encoding <span class="op">=</span> <span class="st">"UTF-8"</span><span class="op">)</span> <span class="co"># l'encoding UTF-8 permet de garder les accents</span></code></pre></div>
</div>
<div id="acquisition-de-la-liste-des-cellules-des-sites-des-noms-despèce-de-référence-et-des-attributs-déjà-présentes-dans-coléo-et-création-dun-objet-r-pour-chacune" class="section level3">
<h3 class="hasAnchor">
<a href="#acquisition-de-la-liste-des-cellules-des-sites-des-noms-desp%C3%A8ce-de-r%C3%A9f%C3%A9rence-et-des-attributs-d%C3%A9j%C3%A0-pr%C3%A9sentes-dans-col%C3%A9o-et-cr%C3%A9ation-dun-objet-r-pour-chacune" class="anchor"></a>7.2. Acquisition de la liste des cellules, des sites, des noms d’espèce de référence et des attributs déjà présentes dans Coléo et création d’un objet R pour chacune</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Acquisition cellules COLEO</span>
<span class="va">cells</span> <span class="op">&lt;-</span> <span class="fu">rcoleo</span><span class="fu">::</span><span class="fu"><a href="../reference/get_cells.html">get_cells</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">cells</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="st">"rbind"</span>, <span class="va">cells</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">body</span><span class="op">)</span>

<span class="co"># Acquisition sites COLEO</span>
<span class="va">sites</span> <span class="op">&lt;-</span> <span class="fu">rcoleo</span><span class="fu">::</span><span class="fu"><a href="../reference/get_sites.html">get_sites</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">sites</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="st">"rbind"</span>, <span class="va">sites</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">body</span><span class="op">)</span>

<span class="co"># Acquisition nom espèces COLEO</span>
<span class="va">species</span> <span class="op">&lt;-</span> <span class="fu">rcoleo</span><span class="fu">::</span><span class="fu"><a href="../reference/get_species.html">get_species</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="st">"rbind"</span>, <span class="va">species</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">body</span><span class="op">)</span></code></pre></div>
</div>
<div id="vérification-de-lexistence-des-cellules-sites-noms-despèces-et-des-attributs-associés-aux-nouvelles-campagnes-zooplancton-dans-coléo" class="section level3">
<h3 class="hasAnchor">
<a href="#v%C3%A9rification-de-lexistence-des-cellules-sites-noms-desp%C3%A8ces-et-des-attributs-associ%C3%A9s-aux-nouvelles-campagnes-zooplancton-dans-col%C3%A9o" class="anchor"></a>7.3. Vérification de l’existence des cellules, sites, noms d’espèces et des attributs associés aux nouvelles campagnes <em>zooplancton</em> dans Coléo</h3>
<div id="pour-les-cellules" class="section level4">
<h4 class="hasAnchor">
<a href="#pour-les-cellules" class="anchor"></a>7.3.1. Pour les cellules</h4>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#### Test pour vérifier l'existence des cellules dans Coléo ####</span>
<span class="fu">rcoleo</span><span class="fu">::</span><span class="fu">COLEO_comp</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">camp_zoopl</span><span class="op">$</span><span class="va">no_de_reference_de_la_cellule</span><span class="op">)</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">cells</span><span class="op">$</span><span class="va">cell_code</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>La sortie R vous indique si vous pouvez passer à l’étape suivante ou non. Dans le cas où certaines cellules n’existent pas dans Coléo, il sera nécessaire d’importer ces cellules avant de continuer l’insertions des nouvelles campagnes <em>zooplancton</em>. Pour ce faire, vous pouvez suivre les étapes détaillées dans la vignette <a href="injection-cellules.html"><em>Injection des cellules</em></a>.</p>
</div>
<div id="pour-les-sites" class="section level4">
<h4 class="hasAnchor">
<a href="#pour-les-sites" class="anchor"></a>7.3.2. Pour les sites</h4>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#### Test pour vérifier l'existence des sites dans Coléo ####</span>
<span class="fu">rcoleo</span><span class="fu">::</span><span class="fu">COLEO_comp</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">camp_zoopl</span><span class="op">$</span><span class="va">no_de_reference_du_site</span><span class="op">)</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">sites</span><span class="op">$</span><span class="va">site_code</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>La sortie R vous indique si vous pouvez passer à l’étape suivante ou non. Dans le cas où certains sites n’existent pas dans Coléo, il sera nécessaire d’importer ces sites avant de continuer l’insertions des nouvelles campagnes <em>zooplancton</em>. Pour ce faire, vous pouvez suivre les étapes détaillées dans la vignette <a href="injection-sites.html"><em>Injection des sites</em></a>.</p>
</div>
<div id="pour-les-noms-despèces" class="section level4">
<h4 class="hasAnchor">
<a href="#pour-les-noms-desp%C3%A8ces" class="anchor"></a>7.3.3. Pour les noms d’espèces</h4>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#### Test pour vérifier l'existence des noms des espèces dans Coléo ####</span>
<span class="fu">rcoleo</span><span class="fu">::</span><span class="fu">COLEO_comp</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">camp_zoopl</span><span class="op">$</span><span class="va">nom_scientifique</span><span class="op">)</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">species</span><span class="op">$</span><span class="va">name</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>La sortie R vous indique si vous pouvez passer à l’étape suivante ou non. Dans le cas où certains noms d’espèces n’existent pas dans Coléo, il sera nécessaire d’importer ces noms avant de continuer l’insertions des nouvelles campagnes <em>zooplancton</em>. Pour ce faire, vous pouvez suivre les étapes détaillées dans la vignette <a href="injection-taxa.html"><em>Injection des noms d’espèce</em></a>.</p>
</div>
<div id="pour-les-attributs" class="section level4">
<h4 class="hasAnchor">
<a href="#pour-les-attributs" class="anchor"></a>7.3.4. Pour les attributs</h4>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#### Variables tables "attributes" ####</span>
<span class="fu">rcoleo</span><span class="fu">::</span><span class="fu"><a href="../reference/get_gen.html">get_gen</a></span><span class="op">(</span><span class="st">"/attributes"</span><span class="op">)</span></code></pre></div>
<p>Vous pouvez vérifier ici si la variable <code>abondance</code> est présente dans ce tableau.</p>
</div>
</div>
</div>
<div id="injections-des-nouvelles-campagnes-zooplancton" class="section level2">
<h2 class="hasAnchor">
<a href="#injections-des-nouvelles-campagnes-zooplancton" class="anchor"></a>8. Injections des nouvelles campagnes <em>zooplancton</em>
</h2>
<p>Pour une injection complète d’une campagne, il est nécessaire de passer par l’importation d’informations successives dans différentes tables de Coléo. La hiérarchie des tables à renseigner est cruciale, sans quoi l’injection de la campagne est vouée à l’échec. Les prochaines étapes détaillent l’ajout d’information dans les tables:</p>
<ol style="list-style-type: decimal">
<li>Campagnes (“<em>/campaigns</em>”)</li>
<li>Repères (“<em>/landmarks</em>”)</li>
<li>Observations (“<em>/observations</em>”)</li>
<li>Observations des espèces (“<em>/obs_species</em>”)</li>
</ol>
<div id="injections-des-informations-sur-les-nouvelles-campagnes" class="section level3">
<h3 class="hasAnchor">
<a href="#injections-des-informations-sur-les-nouvelles-campagnes" class="anchor"></a>8.1. Injections des informations sur les nouvelles campagnes</h3>
<p>Les champs qui peuvent être remplis dans la table <strong>campagnes</strong> (“/campaigns”) de Coléo sont les suivants (les champs en gras sont obligatoires) :</p>
<ul>
<li>
<strong>site_id</strong> : à récupérer dans Coléo</li>
<li>
<strong>type</strong> : nom de la campagne, ici “zooplanctons”</li>
<li>
<strong>technicians</strong> : liste composée de “technicien_1” et “technicien_2”</li>
<li>
<strong>opened_at</strong> : corresppond à “date_debut”</li>
<li>
<strong>closed_at</strong> : correspond à “date_fin”</li>
<li><em>notes</em></li>
</ul>
<div id="on-commence-par-séléctionner-les-champs-dinterêts-on-matche-les-noms-de-variables-avec-celles-de-coléo-" class="section level4">
<h4 class="hasAnchor">
<a href="#on-commence-par-s%C3%A9l%C3%A9ctionner-les-champs-dinter%C3%AAts-on-matche-les-noms-de-variables-avec-celles-de-col%C3%A9o-" class="anchor"></a>8.1.1. On commence par séléctionner les champs d’interêts &amp; on matche les noms de variables avec celles de Coléo.</h4>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">inj_camp_zoop</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">camp_zoopl</span>, site_code<span class="op">=</span><span class="va">no_de_reference_du_site</span>, opened_at<span class="op">=</span><span class="va">date_debut</span>, closed_at<span class="op">=</span><span class="va">date_fin</span>, <span class="va">technicien_1</span>, <span class="va">technicien_2</span><span class="op">)</span></code></pre></div>
</div>
<div id="on-garde-une-ligne-unique-par-nouvelle-campagne-" class="section level4">
<h4 class="hasAnchor">
<a href="#on-garde-une-ligne-unique-par-nouvelle-campagne-" class="anchor"></a>8.1.2. On garde une ligne unique par nouvelle campagne.</h4>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">inj_camp_zoop</span> <span class="op">&lt;-</span> <span class="va">inj_camp_zoop</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="va">inj_camp_zoop</span><span class="op">)</span>,<span class="op">]</span></code></pre></div>
</div>
<div id="on-récupère-le-site_id-nécessaire-à-linjection-" class="section level4">
<h4 class="hasAnchor">
<a href="#on-r%C3%A9cup%C3%A8re-le-site_id-n%C3%A9cessaire-%C3%A0-linjection-" class="anchor"></a>8.1.3. On récupère le <code>site_id</code>, nécessaire à l’injection.</h4>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">inj_camp_zoop</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">inj_camp_zoop</span>, <span class="va">sites</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span><span class="op">]</span>, by <span class="op">=</span> <span class="st">"site_code"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">inj_camp_zoop</span><span class="op">)</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"site_id"</span></code></pre></div>
</div>
<div id="on-créé-une-liste-pour-le-nom-des-techniciennes-" class="section level4">
<h4 class="hasAnchor">
<a href="#on-cr%C3%A9%C3%A9-une-liste-pour-le-nom-des-techniciennes-" class="anchor"></a>8.1.4. On créé une liste pour le nom des technicien/ne/s.</h4>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tech</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># Création d'un objet `list` vide</span>

<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">inj_camp_zoop</span><span class="op">$</span><span class="va">site_code</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">tech</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">inj_camp_zoop</span><span class="op">$</span><span class="va">technicien_1</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="va">inj_camp_zoop</span><span class="op">$</span><span class="va">technicien_2</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span> <span class="co"># Chaque niveau de la liste correspond à une association des deux noms des technicien/ne/s pour chaque ligne du tableau</span>

<span class="va">inj_camp_zoop</span><span class="op">$</span><span class="va">technicians</span> <span class="op">&lt;-</span> <span class="va">tech</span> <span class="co"># Ajout de la liste au tableau à injecter dans Coléo</span></code></pre></div>
</div>
<div id="on-renseigne-le-type-de-campagnes-ici-zooplancton--prenez-garde-à-bien-conserver-la-même-orthographe-" class="section level4">
<h4 class="hasAnchor">
<a href="#on-renseigne-le-type-de-campagnes-ici-zooplancton--prenez-garde-%C3%A0-bien-conserver-la-m%C3%AAme-orthographe-" class="anchor"></a>8.1.5. On renseigne le type de campagnes, ici <strong>zooplancton</strong>. Prenez garde à bien conserver la même orthographe.</h4>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">inj_camp_zoop</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"zooplancton"</span></code></pre></div>
</div>
<div id="on-tansforme-le-tableau-en-liste-afin-de-pouvoir-linjecter-dans-coléo-" class="section level4">
<h4 class="hasAnchor">
<a href="#on-tansforme-le-tableau-en-liste-afin-de-pouvoir-linjecter-dans-col%C3%A9o-" class="anchor"></a>8.1.6. On tansforme le tableau en liste afin de pouvoir l’injecter dans Coléo.</h4>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">camp_ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">inj_camp_zoop</span>,<span class="fl">1</span>,<span class="va">as.list</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">camp_ls</span><span class="op">)</span></code></pre></div>
</div>
<div id="il-est-maintenant-possible-de-procéder-à-linjection-" class="section level4">
<h4 class="hasAnchor">
<a href="#il-est-maintenant-possible-de-proc%C3%A9der-%C3%A0-linjection-" class="anchor"></a>8.1.7. Il est maintenant possible de procéder à l’injection.</h4>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">COLEO_camp_inj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/post_campaigns.html">post_campaigns</a></span><span class="op">(</span><span class="va">camp_ls</span><span class="op">)</span></code></pre></div>
<p>La sortie R vous informe sur le déroulement de l’insertion. Le message <code>Good job ! Toutes les insertions ont été créées dans COLEO</code> indique que les informations ont bien été enregistrées dans Coléo. Dans le cas inverse, le message <code>Oups... un problème est survenu</code> apparait, suivi des codes de statut pour chaque requête d’injections (pour plus d’informations à propos des <a href="https://http.cat/">codes de statut</a>).</p>
</div>
</div>
<div id="injections-des-repères-associés-aux-nouvelles-campagnes" class="section level3">
<h3 class="hasAnchor">
<a href="#injections-des-rep%C3%A8res-associ%C3%A9s-aux-nouvelles-campagnes" class="anchor"></a>8.2. Injections des repères associés aux nouvelles campagnes</h3>
<p>Les champs qui peuvent être remplis dans Coléo sont les suivants (les champs en gras sont obligatoires) :</p>
<ul>
<li>
<strong>campaign_id</strong> : doit matcher avec site_code/site_id &amp; opened_at</li>
<li><strong>geom</strong></li>
</ul>
<div id="on-commence-par-séléctionner-les-champs-dinterêts-on-matche-les-noms-de-variables-avec-celles-de-coléo--1" class="section level4">
<h4 class="hasAnchor">
<a href="#on-commence-par-s%C3%A9l%C3%A9ctionner-les-champs-dinter%C3%AAts-on-matche-les-noms-de-variables-avec-celles-de-col%C3%A9o--1" class="anchor"></a>8.2.1. On commence par séléctionner les champs d’interêts &amp; on matche les noms de variables avec celles de Coléo.</h4>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">inj_land_zoop</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">camp_zoopl</span>, site_code<span class="op">=</span><span class="va">no_de_reference_du_site</span>, opened_at<span class="op">=</span><span class="va">date_debut</span>, lat<span class="op">=</span><span class="va">latitude</span>, lon <span class="op">=</span> <span class="va">longitude</span><span class="op">)</span></code></pre></div>
</div>
<div id="on-récupère-le-site_id-nécessaire-à-linjection--1" class="section level4">
<h4 class="hasAnchor">
<a href="#on-r%C3%A9cup%C3%A8re-le-site_id-n%C3%A9cessaire-%C3%A0-linjection--1" class="anchor"></a>8.2.2. On récupère le <code>site_id</code>, nécessaire à l’injection.</h4>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">inj_land_zoop</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">inj_land_zoop</span>, <span class="va">sites</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span>, by <span class="op">=</span> <span class="st">"site_code"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">inj_land_zoop</span><span class="op">)</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"site_id"</span></code></pre></div>
</div>
<div id="on-récupère-le-campaign_id-nécessaire-à-linjection-" class="section level4">
<h4 class="hasAnchor">
<a href="#on-r%C3%A9cup%C3%A8re-le-campaign_id-n%C3%A9cessaire-%C3%A0-linjection-" class="anchor"></a>8.2.3. On récupère le <code>campaign_id</code>, nécessaire à l’injection.</h4>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">inj_land_zoop</span><span class="op">$</span><span class="va">opened_at</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">inj_land_zoop</span><span class="op">$</span><span class="va">opened_at</span><span class="op">)</span>
<span class="va">inj_land_zoop</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">inj_land_zoop</span>, <span class="va">camp</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span><span class="op">)</span><span class="op">]</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"site_id"</span>, <span class="st">"opened_at"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">inj_land_zoop</span><span class="op">)</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"campaign_id"</span></code></pre></div>
</div>
<div id="on-garde-une-ligne-par-repère-cest-à-dire-par-campagne-" class="section level4">
<h4 class="hasAnchor">
<a href="#on-garde-une-ligne-par-rep%C3%A8re-cest-%C3%A0-dire-par-campagne-" class="anchor"></a>8.2.4. On garde une ligne par repère (c’est-à-dire par campagne).</h4>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">inj_land_zoop</span> <span class="op">&lt;-</span> <span class="va">inj_land_zoop</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="va">inj_land_zoop</span><span class="op">)</span>,<span class="op">]</span></code></pre></div>
</div>
<div id="on-transforme-le-tableau-en-liste-pour-pouvoir-linjecter-dans-coléo-" class="section level4">
<h4 class="hasAnchor">
<a href="#on-transforme-le-tableau-en-liste-pour-pouvoir-linjecter-dans-col%C3%A9o-" class="anchor"></a>8.2.5. On transforme le tableau en liste pour pouvoir l’injecter dans Coléo.</h4>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">land_ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">inj_land_zoop</span>,<span class="fl">1</span>,<span class="va">as.list</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">land_ls</span><span class="op">)</span></code></pre></div>
</div>
<div id="on-créé-le-champs-geom-de-coleo-sous-forme-de-liste-en-utilisant-les-variables-lat-lon-du-tableau-" class="section level4">
<h4 class="hasAnchor">
<a href="#on-cr%C3%A9%C3%A9-le-champs-geom-de-coleo-sous-forme-de-liste-en-utilisant-les-variables-lat-lon-du-tableau-" class="anchor"></a>8.2.6. On créé le champs <code>geom</code> de COLEO, sous forme de liste, en utilisant les variables <em>lat</em> &amp; <em>lon</em> du tableau.</h4>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">geom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">inj_land_zoop</span>,<span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>
<span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="st">"lat"</span><span class="op">]</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="st">"lon"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu">geojsonio</span><span class="fu">::</span><span class="fu">geojson_list</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="st">"lon"</span><span class="op">]</span>,<span class="va">x</span><span class="op">[</span><span class="st">"lat"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">features</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">geometry</span><span class="op">)</span>
<span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>
<span class="op">}</span><span class="op">}</span><span class="op">)</span></code></pre></div>
</div>
<div id="on-fusionne-les-deux-listes-en-prévision-de-linjection-dans-coléo-" class="section level4">
<h4 class="hasAnchor">
<a href="#on-fusionne-les-deux-listes-en-pr%C3%A9vision-de-linjection-dans-col%C3%A9o-" class="anchor"></a>8.2.7. On fusionne les deux listes en prévision de l’injection dans Coléo.</h4>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">land_ls</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
 <span class="va">land_ls</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">geom</span> <span class="op">&lt;-</span> <span class="va">geom</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
 <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">is.list</a></span><span class="op">(</span><span class="va">land_ls</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">geom</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
   <span class="va">land_ls</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">geom</span><span class="op">$</span><span class="va">crs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"name"</span>,properties<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"EPSG:4326"</span><span class="op">)</span><span class="op">)</span>
 <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<p>La sortie R vous informe sur le déroulement de l’insertion. Le message <code>Good job ! Toutes les insertions ont été créées dans COLEO</code> indique que les informations ont bien été enregistrées dans Coléo. Dans le cas inverse, le message <code>Oups... un problème est survenu</code> apparait, suivi des codes de statut pour chaque requête d’injections (pour plus d’informations à propos des <a href="https://http.cat/">codes de statut</a>).</p>
</div>
<div id="il-est-maintenant-possible-de-procéder-à-linjection--1" class="section level4">
<h4 class="hasAnchor">
<a href="#il-est-maintenant-possible-de-proc%C3%A9der-%C3%A0-linjection--1" class="anchor"></a>8.2.7. Il est maintenant possible de procéder à l’injection.</h4>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">COLEO_land_inj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/post_landmarks.html">post_landmarks</a></span><span class="op">(</span><span class="va">land_ls</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="injections-des-observations-associées-aux-nouvelles-campagnes" class="section level3">
<h3 class="hasAnchor">
<a href="#injections-des-observations-associ%C3%A9es-aux-nouvelles-campagnes" class="anchor"></a>8.3. Injections des observations associées aux nouvelles campagnes</h3>
<p>Les champs qui peuvent être remplis dans Coléo sont les suivants (les champs en gras sont obligatoires) :</p>
<ul>
<li>
<strong>date_obs</strong> : date_debut</li>
<li>
<strong>is_valid</strong> : par défaut = 1</li>
<li>
<strong>campaign_id</strong> : récupération avec site_id et opened_at(=date_obs)</li>
<li><em>campaign_info</em></li>
<li><em>time_obs</em></li>
<li><em>stratum</em></li>
<li><em>axis</em></li>
<li><em>distance</em></li>
<li><em>distance_unit</em></li>
<li>
<em>depth</em> : Profondeur_m</li>
<li><em>sample_id</em></li>
<li><em>thermograph_id</em></li>
<li>
<em>notes</em> : Date_denombrement + Taxonomiste</li>
</ul>
<div id="on-séléctionne-les-champs-dinterêts-on-matche-les-noms-de-variables-avec-celles-de-coléo-" class="section level4">
<h4 class="hasAnchor">
<a href="#on-s%C3%A9l%C3%A9ctionne-les-champs-dinter%C3%AAts-on-matche-les-noms-de-variables-avec-celles-de-col%C3%A9o-" class="anchor"></a>8.3.1. On séléctionne les champs d’interêts &amp; on matche les noms de variables avec celles de Coléo.</h4>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">inj_obs_zoop</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">camp_zoopl</span>, site_code<span class="op">=</span><span class="va">no_de_reference_du_site</span>, opened_at<span class="op">=</span><span class="va">date_debut</span>, depth <span class="op">=</span> <span class="va">Profondeur_m</span><span class="op">)</span>
<span class="va">inj_obs_zoop</span><span class="op">$</span><span class="va">is_valid</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">inj_obs_zoop</span><span class="op">$</span><span class="va">notes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">camp_zoopl</span><span class="op">$</span><span class="va">Taxonomiste</span>, <span class="st">"Date_denombrement"</span>, <span class="va">camp_zoopl</span><span class="op">$</span><span class="va">Date_denombrement</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span></code></pre></div>
</div>
<div id="on-récupère-le-site_id-néceesaire-à-linjection-" class="section level4">
<h4 class="hasAnchor">
<a href="#on-r%C3%A9cup%C3%A8re-le-site_id-n%C3%A9ceesaire-%C3%A0-linjection-" class="anchor"></a>8.3.2. On récupère le <code>site_id</code>, néceesaire à l’injection.</h4>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">inj_obs_zoop</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">inj_obs_zoop</span>, <span class="va">sites</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span>, by <span class="op">=</span> <span class="st">"site_code"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">inj_obs_zoop</span><span class="op">)</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"site_id"</span></code></pre></div>
</div>
<div id="on-récupère-le-campaign_id-nécessaire-à-linjection--1" class="section level4">
<h4 class="hasAnchor">
<a href="#on-r%C3%A9cup%C3%A8re-le-campaign_id-n%C3%A9cessaire-%C3%A0-linjection--1" class="anchor"></a>8.3.3. On récupère le <code>campaign_id</code>, nécessaire à l’injection.</h4>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">inj_obs_zoop</span><span class="op">$</span><span class="va">opened_at</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">inj_obs_zoop</span><span class="op">$</span><span class="va">opened_at</span><span class="op">)</span>
<span class="va">inj_obs_zoop</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">inj_obs_zoop</span>, <span class="va">camp</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span><span class="op">)</span><span class="op">]</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"site_id"</span>, <span class="st">"opened_at"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">inj_obs_zoop</span><span class="op">)</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"campaign_id"</span></code></pre></div>
</div>
<div id="on-modifie-le-nom-pour-la-date-dobservation-" class="section level4">
<h4 class="hasAnchor">
<a href="#on-modifie-le-nom-pour-la-date-dobservation-" class="anchor"></a>8.3.4. On modifie le nom pour la date d’observation.</h4>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">inj_obs_zoop</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"date_obs"</span></code></pre></div>
</div>
<div id="on-conserve-les-lignes-uniques-du-jeu-de-données-" class="section level4">
<h4 class="hasAnchor">
<a href="#on-conserve-les-lignes-uniques-du-jeu-de-donn%C3%A9es-" class="anchor"></a>8.3.5. On conserve les lignes uniques du jeu de données.</h4>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">inj_obs_zoop</span> <span class="op">&lt;-</span> <span class="va">inj_obs_zoop</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="va">inj_obs_zoop</span><span class="op">)</span>,<span class="op">]</span></code></pre></div>
</div>
<div id="on-transforme-le-tableau-en-liste-pour-linjection-dans-coléo-" class="section level4">
<h4 class="hasAnchor">
<a href="#on-transforme-le-tableau-en-liste-pour-linjection-dans-col%C3%A9o-" class="anchor"></a>8.3.6. On transforme le tableau en liste pour l’injection dans Coléo.</h4>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">obs_ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">inj_obs_zoop</span>,<span class="fl">1</span>,<span class="va">as.list</span><span class="op">)</span></code></pre></div>
</div>
<div id="il-est-maintenant-possible-de-procéder-à-linjection--2" class="section level4">
<h4 class="hasAnchor">
<a href="#il-est-maintenant-possible-de-proc%C3%A9der-%C3%A0-linjection--2" class="anchor"></a>8.3.7. Il est maintenant possible de procéder à l’injection.</h4>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">COLEO_obs_inj</span> <span class="op">&lt;-</span> <span class="fu">post_observations</span><span class="op">(</span><span class="va">obs_ls</span><span class="op">)</span></code></pre></div>
<p>La sortie R vous informe sur le déroulement de l’insertion. Le message <code>Good job ! Toutes les insertions ont été créées dans COLEO</code> indique que les informations ont bien été enregistrées dans Coléo. Dans le cas inverse, le message <code>Oups... un problème est survenu</code> apparait, suivi des codes de statut pour chaque requête d’injections (pour plus d’informations à propos des <a href="https://http.cat/">codes de statut</a>).</p>
</div>
</div>
<div id="injections-de-labondance-des-espèces-associées-aux-nouvelles-campagnes" class="section level3">
<h3 class="hasAnchor">
<a href="#injections-de-labondance-des-esp%C3%A8ces-associ%C3%A9es-aux-nouvelles-campagnes" class="anchor"></a>8.4. Injections de l’abondance des espèces associées aux nouvelles campagnes</h3>
<p>Les champs qui peuvent être remplis dans Coléo sont les suivants (les champs en gras sont obligatoires) :</p>
<ul>
<li>
<strong>taxa_name</strong> : nom_scientifique</li>
<li>
<strong>variable</strong> : “abondance”</li>
<li>
<strong>observation_id</strong> : à récupérer avec site_id –&gt; site_code –&gt; campaign_id + opened_at</li>
<li>
<em>value</em> : abondance</li>
</ul>
<div id="on-séléctionne-les-champs-dinterêts-on-matche-les-noms-de-variables-avec-celles-de-coléo--1" class="section level4">
<h4 class="hasAnchor">
<a href="#on-s%C3%A9l%C3%A9ctionne-les-champs-dinter%C3%AAts-on-matche-les-noms-de-variables-avec-celles-de-col%C3%A9o--1" class="anchor"></a>8.4.1. On séléctionne les champs d’interêts &amp; on matche les noms de variables avec celles de Coléo.</h4>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">inj_data_zoop</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">camp_zoopl</span>, site_code<span class="op">=</span><span class="va">no_de_reference_du_site</span>, opened_at<span class="op">=</span><span class="va">date_debut</span>, taxa_name <span class="op">=</span> <span class="va">nom_scientifique</span>, value <span class="op">=</span> <span class="va">abondance</span><span class="op">)</span>
<span class="va">inj_data_zoop</span><span class="op">$</span><span class="va">variable</span> <span class="op">&lt;-</span> <span class="st">"abondance"</span></code></pre></div>
</div>
<div id="on-récupère-le-site_id-nécessaire-à-linjection--2" class="section level4">
<h4 class="hasAnchor">
<a href="#on-r%C3%A9cup%C3%A8re-le-site_id-n%C3%A9cessaire-%C3%A0-linjection--2" class="anchor"></a>8.4.2. On récupère le <code>site_id</code>, nécessaire à l’injection.</h4>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">inj_data_zoop</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">inj_data_zoop</span>, <span class="va">sites</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span>, by <span class="op">=</span> <span class="st">"site_code"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">inj_data_zoop</span><span class="op">)</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"site_id"</span></code></pre></div>
</div>
<div id="on-récupère-le-campaign_id-nécessaire-à-linjection--2" class="section level4">
<h4 class="hasAnchor">
<a href="#on-r%C3%A9cup%C3%A8re-le-campaign_id-n%C3%A9cessaire-%C3%A0-linjection--2" class="anchor"></a>8.4.3. On récupère le <code>campaign_id</code>, nécessaire à l’injection.</h4>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">inj_data_zoop</span><span class="op">$</span><span class="va">opened_at</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">inj_data_zoop</span><span class="op">$</span><span class="va">opened_at</span><span class="op">)</span>
<span class="va">inj_data_zoop</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">inj_data_zoop</span>, <span class="va">camp</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span><span class="op">)</span><span class="op">]</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"site_id"</span>, <span class="st">"opened_at"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">inj_data_zoop</span><span class="op">)</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"campaign_id"</span></code></pre></div>
</div>
<div id="on-récupère-le-observation_id-nécessaire-à-linjection-" class="section level4">
<h4 class="hasAnchor">
<a href="#on-r%C3%A9cup%C3%A8re-le-observation_id-n%C3%A9cessaire-%C3%A0-linjection-" class="anchor"></a>8.4.4. On récupère le <code>observation_id</code>, nécessaire à l’injection.</h4>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">inj_data_zoop</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"date_obs"</span>
<span class="va">inj_data_zoop</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">inj_data_zoop</span>, <span class="va">obs</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">12</span><span class="op">)</span><span class="op">]</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"campaign_id"</span>, <span class="st">"date_obs"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">inj_data_zoop</span><span class="op">)</span><span class="op">[</span><span class="fl">8</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"observation_id"</span></code></pre></div>
</div>
<div id="on-transforme-le-jeu-de-données-en-liste-pour-linjection-dans-coléo-" class="section level4">
<h4 class="hasAnchor">
<a href="#on-transforme-le-jeu-de-donn%C3%A9es-en-liste-pour-linjection-dans-col%C3%A9o-" class="anchor"></a>8.4.5. On transforme le jeu de données en liste pour l’injection dans Coléo.</h4>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">inj_data_zoop</span>,<span class="fl">1</span>,<span class="va">as.list</span><span class="op">)</span></code></pre></div>
</div>
<div id="il-est-maintenant-possible-de-procéder-à-linjection--3" class="section level4">
<h4 class="hasAnchor">
<a href="#il-est-maintenant-possible-de-proc%C3%A9der-%C3%A0-linjection--3" class="anchor"></a>8.4.6. Il est maintenant possible de procéder à l’injection.</h4>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">COLEO_data_inj</span> <span class="op">&lt;-</span> <span class="fu">postpost_obs_species</span><span class="op">(</span><span class="va">data_ls</span><span class="op">)</span> <span class="co"># Fonctionnel</span></code></pre></div>
<p>La sortie R vous informe sur le déroulement de l’insertion. Le message <code>Good job ! Toutes les insertions ont été créées dans COLEO</code> indique que les informations ont bien été enregistrées dans Coléo. Bravo ! Vous venez de terminer les étapes d’injections des campagnes <strong>zooplancton</strong> ! Dans le cas inverse, le message <code>Oups... un problème est survenu</code> apparait, suivi des codes de statut pour chaque requête d’injections (pour plus d’informations à propos des <a href="https://http.cat/">codes de statut</a>).</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Steve Vissault.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'API_KEY',
    indexName: 'INDEX_NAME',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
