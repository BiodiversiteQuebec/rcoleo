---
title: "Injection des sites"
author: "Andrew MacDonald"
date: "`r Sys.Date()`"
output:
  prettydoc::html_pretty:
    theme: cayman
    highlight: github
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

the first step in injecting data in to the Coleo database is data validation (see vignette on data validation)

Once data is validated we can begin injection

## Injecting sites

In all campaigns, the first step is to confirm that all the sites are present. 

We begin by preparing the dataset for injection

```{r, include=FALSE}
library(httptest2)
start_vignette("coleo_site_injection")
```

```{r, include=FALSE}
insect_demo <- tibble::tribble(
  ~campaign_type,    ~site_code, ~campaign_date_opened, ~campaign_date_closed, ~observation_date, ~observation_is_valid, ~trap_code,  ~land_lat,  ~land_lon, ~sample_code,                                                                  ~campaign_technician_1,       ~ref_taxa_rank, ~ref_taxa_tsn,                 ~ref_taxa_name,         ~observation_taxa_name, ~observation_variable, ~observation_value,                                  ~observation_notes,
  "insectes_sol",  "102_90_F01",          "2020-06-02",          "2020-06-23",      "2020-06-23",                  TRUE,    "MP-11",   48.16126,  -78.67106,  "2020-0083",                                          "Isabelle_Dumais,Alexane_Gaudet,Annie_Hibbert",             "espèce",            NA,            "Cybaeopsis_euopla",            "Cybaeopsis_euopla",           "abondance",                  1,                                                  NA,
  "insectes_sol",  "102_90_F01",          "2020-06-23",          "2020-07-14",      "2020-07-14",                  TRUE,    "MP-25",   48.16133,  -78.67088,  "2020-0095",                                          "Isabelle_Dumais,Alexane_Gaudet,Annie_Hibbert",             "espèce",            NA,        "Bathyphantes_pallidus",        "Bathyphantes_pallidus",           "abondance",                  1,                                                  NA,
  "insectes_sol", "105_101_F01",          "2019-06-06",          "2019-06-27",      "2019-06-27",                  TRUE,    "MP-61",   49.10241,   -76.9938,  "2019-0130",                                   "Daniel_Potvin_Leduc,Christine_Lambert,Annie_Hibbert",             "espèce",            NA,              "Cicurina_brevis",              "Cicurina_brevis",           "abondance",                  1,                                                  NA,
  "insectes_sol", "105_101_F01",          "2019-06-06",          "2019-06-27",      "2019-06-27",                  TRUE,    "MP-66",   49.10251,  -76.99409,  "2019-0132",                                   "Daniel_Potvin_Leduc,Christine_Lambert,Annie_Hibbert",             "espèce",            NA,            "Cybaeopsis_euopla",            "Cybaeopsis_euopla",           "abondance",                 13,                                                  NA,
  "insectes_sol", "108_119_F01",          "2020-06-08",          "2020-06-30",      "2020-06-30",                  TRUE,    "D-SE1",   50.56681,  -74.44849,  "2020-0100",                                      "Marine_Serra_David,William_Rondeau,Annie_Hibbert",             "espèce",            NA, "Ozyptila_sincera_canadensis_", "Ozyptila_sincera_canadensis_",           "abondance",                  2,                                                  NA,
  "insectes_sol", "108_119_F01",          "2020-06-30",          "2020-07-21",      "2020-07-21",                  TRUE,    "H-NW1",   50.56691,   -74.4481,  "2020-0107",                                      "Marine_Serra_David,William_Rondeau,Annie_Hibbert",            "famille",            NA,                  "Linyphiidae",                  "Linyphiidae",           "abondance",                  1,                                                  NA,
  "insectes_sol", "111_115_F01",          "2018-06-13",          "2018-07-10",      "2018-07-10",                  TRUE,    "MP-61",  49.834332, -74.377702,  "2018-0123",                                                                      "Mathieu_Bouchard",             "espèce",            NA,         "Myrmica_detritinodis",         "Myrmica_detritinodis",           "abondance",                  1,                                                  NA,
  "insectes_sol", "111_115_F01",          "2018-06-13",          "2018-07-10",      "2018-07-10",                  TRUE,    "MP-73",  49.834163, -74.377919,  "2018-0127",                                                                       "Jessica_Turgeon",             "espèce",            NA,              "Pirata_bryantae",              "Pirata_bryantae",           "abondance",                  9,                                                  NA,
  "insectes_sol",  "123_92_F01",          "2019-05-29",          "2019-06-20",      "2019-06-20",                  TRUE,    "MP-15",   46.76997,  -75.46084,  "2019-0102",                                    "Veronique_St_Hilaire,Sebastien_Auger,Annie_Hibbert",             "classe",            NA,                      "Insecta",                      "Insecta",           "abondance",                  3,                                                  NA,
  "insectes_sol",  "123_92_F01",          "2019-06-20",          "2019-07-09",      "2019-07-09",                  TRUE,    "MP-25",   46.76986,  -75.46088,  "2019-0112",                                    "Veronique_St_Hilaire,Sebastien_Auger,Annie_Hibbert",             "espèce",            NA,           "Eperigone_maculata",           "Eperigone_maculata",           "abondance",                  7,                                                  NA,
  "insectes_sol",  "124_86_F01",          "2018-05-31",          "2018-06-21",      "2018-06-21",                  TRUE,    "MP-65",  46.089096, -75.833158,  "2018-0158",                                                          "Jocelyn_Caron,Olivier_Trudel",              "ordre",            NA,                   "Orthoptera",                   "Orthoptera",           "abondance",                  8,                                                  NA,
  "insectes_sol",  "124_86_F01",          "2018-05-31",          "2018-06-21",      "2018-06-21",                  TRUE,    "MP-78",   46.08912, -75.833387,  "2018-0159",                                                          "Jocelyn_Caron,Olivier_Trudel",              "ordre",            NA,                   "Coleoptera",                   "Coleoptera",           "abondance",                  4,                                                  NA,
  "insectes_sol",  "125_81_F01",          "2020-06-09",          "2020-07-08",      "2020-07-08",                  TRUE,    "MP-53",  45.498807, -76.311157,  "2020-0057",                                 "Kevin_Quirion_Poirier,Maude_Cote_Bedard,Annie_Hibbert",             "classe",            NA,                   "Collembola",                   "Collembola",           "abondance",                  1,                                                  NA,
  "insectes_sol",  "125_81_F01",          "2020-05-22",          "2020-06-09",      "2020-06-09",                  TRUE,    "MP-79",   45.49904,  -76.31109,  "2020-0056",                                 "Kevin_Quirion_Poirier,Maude_Cote_Bedard,Annie_Hibbert",            "famille",            NA,                   "Formicidae",                   "Formicidae",           "abondance",                  3,               "Fichier ID non trouvé/Pas identifié",
  "insectes_sol", "126_116_F01",          "2018-06-12",          "2018-06-27",      "2018-06-27",                  TRUE,    "MP-33",   48.70549,  -71.95214,  "2018-0169",                                                                       "Jessica_Turgeon",             "espèce",            NA,              "Cicurina_brevis",              "Cicurina_brevis",           "abondance",                  1,                                                  NA,
  "insectes_sol", "126_116_F01",          "2018-06-27",          "2018-08-02",      "2018-08-02",                  TRUE,    "MP-37",   48.70567,  -71.95189,  "2018-0179",                                                                                      NA,              "ordre",            NA,                    "Hemiptera",                    "Hemiptera",           "abondance",                  3,                                                  NA,
  "insectes_sol", "128_120_F01",          "2020-06-15",          "2020-07-06",      "2020-07-06",                  TRUE,     "IF-G",   48.67135,  -71.11741,  "2020-0023",                                          "Mathieu_McCann,Daniel_Gauthier,Annie_Hibbert",             "classe",            NA,                   "Gastropoda",                   "Gastropoda",           "abondance",                  5,                                                  NA,
  "insectes_sol", "128_120_F01",          "2020-06-15",          "2020-07-06",      "2020-07-06",                  TRUE,     "IF-E",   48.67126,  -71.11758,  "2020-0021",                                          "Mathieu_McCann,Daniel_Gauthier,Annie_Hibbert",            "famille",            NA,                 "Phalangiidae",                 "Phalangiidae",           "abondance",                  2,                                                  NA,
  "insectes_sol",  "128_89_F01",          "2019-06-11",          "2019-07-16",      "2019-07-16",                  TRUE,    "MP-54",   45.98349,  -75.16582,  "2019-0153",                                     "Jocelyn_Caron,Kevin_Quirion_Poirier,Annie_Hibbert",            "famille",            NA,                 "Amaurobiidae",                 "Amaurobiidae",           "abondance",                  1,                                                  NA,
  "insectes_sol",  "128_89_F01",          "2019-05-29",          "2019-06-11",      "2019-06-11",                  TRUE,    "MP-63",   45.98349,  -75.16582,  "2019-0147",                                     "Jocelyn_Caron,Kevin_Quirion_Poirier,Annie_Hibbert",             "classe",            NA,                   "Collembola",                   "Collembola",           "abondance",                  1,                                                  NA,
  "insectes_sol", "129_123_F01",          "2019-05-29",          "2019-07-02",      "2019-07-02",                  TRUE,    "INS-4",   49.11816,  -70.60526,  "2019-0163",                                          "Mathieu_McCann,Daniel_Gauthier,Annie_Hibbert",             "espèce",            NA,           "Pardosa_hyperborea",           "Pardosa_hyperborea",           "abondance",                  3,                                                  NA,
  "insectes_sol", "129_123_F01",          "2019-07-02",          "2019-07-19",      "2019-07-19",                  TRUE,    "INS-6",   49.11816,  -70.60551,  "2019-0173",                                          "Mathieu_McCann,Daniel_Gauthier,Annie_Hibbert",             "espèce",            NA,            "Cryphoeca_montana",            "Cryphoeca_montana",           "abondance",                  1,                                                  NA,
  "insectes_sol",  "129_94_F01",          "2019-07-03",          "2019-07-24",      "2019-07-24",                  TRUE,   "MP-142",   46.40003,  -74.28293,  "2019-0089",                                          "Emilie_Dorion,Jacques_Tremblay,Annie_Hibbert",              "ordre",            NA,                      "Diptera",                      "Diptera",           "abondance",                  6,                                                  NA,
  "insectes_sol",  "129_94_F01",          "2019-07-03",          "2019-07-24",      "2019-07-24",                  TRUE,   "MP-142",   46.40003,  -74.28293,  "2019-0089",                                          "Emilie_Dorion,Jacques_Tremblay,Annie_Hibbert",              "ordre",            NA,                   "Coleoptera",                   "Coleoptera",           "abondance",                  1,                                                  NA,
  "insectes_sol",  "130_86_F01",          "2019-05-30",          "2019-06-14",      "2019-06-14",                  TRUE,   "MP-223",   45.60101,  -75.12672,  "2019-0183",                                                       "Jean_MarVallieres,Annie_Hibbert",        "sous-classe",            NA,                      "Acarina",                      "Acarina",           "abondance",                  3,                                                  NA,
  "insectes_sol",  "130_86_F01",          "2019-06-14",          "2019-07-16",      "2019-07-16",                  TRUE,   "MP-221",   45.60088,  -75.12652,  "2019-0189",                                                       "Jean_MarVallieres,Annie_Hibbert", "sous-embranchement",            NA,                    "Myriapoda",                    "Myriapoda",           "abondance",                  5,                                                  NA,
  "insectes_sol", "131_120_F01",          "2018-07-18",          "2018-08-10",      "2018-08-10",                  TRUE,   "MP-120",   48.58142,  -70.90032,  "2018-0196",                                                                         "Victor_Renaud",             "espèce",            NA,           "Calathus_gregarius",           "Calathus_gregarius",           "abondance",                  1,                                                  NA,
  "insectes_sol", "131_120_F01",          "2018-06-28",          "2018-07-18",      "2018-07-18",                  TRUE,   "MP-121",   48.58137,  -70.90019,  "2018-0204",                                                                                      NA,             "classe",            NA,                      "Insecta",                      "Insecta",           "abondance",                  2,                                                  NA,
  "insectes_sol", "131_120_F02",          "2018-07-25",          "2018-08-10",      "2018-08-10",                  TRUE,   "MP-124",   48.60364,  -70.82963,  "2018-0212",                                                                                      NA,              "ordre",            NA,                   "Coleoptera",                   "Coleoptera",           "abondance",                 14,                                                  NA,
  "insectes_sol", "131_120_F02",          "2018-06-28",          "2018-07-25",      "2018-07-25",                  TRUE,   "MP-124",   48.60364,  -70.82963,  "2018-0206",                                                                                      NA,             "classe",            NA,                   "Gastropoda",                   "Gastropoda",           "abondance",                 32,                                                  NA,
  "insectes_sol", "132_116_F01",          "2016-06-28",          "2016-07-25",      "2016-07-25",                  TRUE,    "MP-14",   48.21632,  -71.26644,  "2016-0018", "Caroline_Dube,Pierre_Alexis_Drolet,Jean_Michel_Beland,Victor_Renaud,Georges_Pelletier",             "espèce",            NA,         "Atheta_pseudomodesta",         "Atheta_pseudomodesta",           "abondance",                  5,                                                  NA,
  "insectes_sol", "132_116_F01",          "2016-06-03",          "2016-06-28",      "2016-06-28",                  TRUE,    "MP-12",   48.21638,  -71.26662,  "2016-0014",                                                    "Caroline_Dube,Pierre_Alexis_Drolet",              "ordre",            NA,                      "Araneae",                      "Araneae",           "abondance",                 27,                                                  NA,
  "insectes_sol", "135_104_F01",          "2016-06-10",          "2016-07-12",      "2016-07-12",                  TRUE,    "MP-06",   46.79401,   -72.3031,  "2016-0011",                      "Caroline_Dube,Jean_Michel_Beland,Victor_Renaud,Georges_Pelletier",             "espèce",            NA,         "Sciaphilus_asperatus",         "Sciaphilus_asperatus",           "abondance",                  4,                                                  NA,
  "insectes_sol", "135_104_F01",          "2016-06-10",          "2016-07-12",      "2016-07-12",                  TRUE,    "MP-07",    46.7941,  -72.30336,  "2016-0012",                                         "Caroline_Dube,Annie_Hibbert,Georges_Pelletier",             "espèce",            NA,       "Pterostichus_coracinus",       "Pterostichus_coracinus",           "abondance",                  1,                                                  NA,
  "insectes_sol", "136_114_F01",          "2018-07-12",          "2018-08-09",      "2018-08-09",                  TRUE,    "MP-42",   47.65277,  -70.80392,  "2018-0009",                                                                          "Anouk_Simard",             "classe",            NA,                      "Insecta",                      "Insecta",           "abondance",                  1,                                                  NA,
  "insectes_sol", "136_114_F01",          "2018-06-15",          "2018-07-12",      "2018-07-12",                  TRUE,    "MP-39",   47.65273,  -70.80389,  "2018-0005",                                                          "Anouk_Simard,Jessica_Turgeon",             "espèce",            NA,       "Walckenaeria_palustris",       "Walckenaeria_palustris",           "abondance",                  6,                                                  NA,
  "insectes_sol", "136_116_T01",          "2017-06-22",          "2017-07-20",      "2017-07-20",                  TRUE,    "MP-17",   47.66654,   -70.7791,  "2017-0034",                                                      "Caroline_Dube,Guillaume_Tremblay",        "sous-classe",            NA,                      "Acarina",                      "Acarina",           "abondance",                  3,                                                  NA,
  "insectes_sol", "136_116_T01",          "2017-06-07",          "2017-06-22",      "2017-06-22",                  TRUE,    "MP-17",   47.66654,   -70.7791,  "2017-0031",                                                      "Caroline_Dube,Guillaume_Tremblay",              "ordre",            NA,                      "Araneae",                      "Araneae",           "abondance",                 10,                                                  NA,
  "insectes_sol",  "136_95_F01",          "2018-05-17",          "2018-06-06",      "2018-06-06",                  TRUE,    "MP-11",   45.94939,  -73.43798,  "2018-0091",                                                        "Virginie_Boivin,Caroline_Dube,",              "ordre",            NA,                    "Hemiptera",                    "Hemiptera",           "abondance",                  4,                                                  NA,
  "insectes_sol",  "136_95_F01",          "2018-06-06",          "2018-07-06",      "2018-07-06",                  TRUE,    "MP-09",   45.94926,  -73.43796,  "2018-0097",                                                        "Virginie_Boivin,Caroline_Dube,",              "ordre",            NA,                 "Siphonaptera",                 "Siphonaptera",           "abondance",                  1,                                                  NA,
  "insectes_sol", "137_107_F01",          "2017-06-20",          "2017-07-10",      "2017-07-10",                  TRUE,    "MP-06",   46.95785,  -71.69477,  "2017-0011",   "Caroline_Dube,Guillaume_Tremblay,Jean_Michel_Beland,Victor_Renaud,Georges_Pelletier",             "espèce",            NA,        "Neohypdonus_tumescens",        "Neohypdonus_tumescens",           "abondance",                  2,                                                  NA,
  "insectes_sol", "137_107_F01",          "2017-05-29",          "2017-06-20",      "2017-06-20",                  TRUE,    "MP-15",     46.958,  -71.69452,  "2017-0009",                                                      "Caroline_Dube,Guillaume_Tremblay",              "ordre",            NA,                      "Diptera",                      "Diptera",           "abondance",                  3,                                                  NA,
  "insectes_sol", "137_110_F01",          "2018-06-26",          "2018-07-24",      "2018-07-24",                  TRUE,    "MP-56",    47.2802,  -71.43315,  "2018-0070",                                                                                      NA,              "ordre",            NA,                      "Diptera",                      "Diptera",           "abondance",                 14,                                                  NA,
  "insectes_sol", "137_110_F01",          "2018-06-26",          "2018-07-24",      "2018-07-24",                  TRUE,    "MP-71",    47.2804,  -71.43352,  "2018-0065",                                                                                      NA,        "sous-classe",            NA,                      "Acarina",                      "Acarina",           "abondance",                 16,                                                  NA,
  "insectes_sol", "137_111_F01",          "2017-05-25",          "2017-06-20",      "2017-06-20",                  TRUE,    "MP-12",   47.17862,  -70.81471,  "2017-0020",   "Caroline_Dube,Guillaume_Tremblay,Jean_Michel_Beland,Victor_Renaud,Georges_Pelletier",             "espèce",            NA,          "Tachinus_fumipennis",          "Tachinus_fumipennis",           "abondance",                  1,                                                  NA,
  "insectes_sol", "137_111_F01",          "2017-05-25",          "2017-06-20",      "2017-06-20",                  TRUE,    "MP-12",   47.17862,  -70.81471,  "2017-0020",   "Caroline_Dube,Guillaume_Tremblay,Jean_Michel_Beland,Victor_Renaud,Georges_Pelletier",             "espèce",            NA,         "Dinothenarus_badipes",         "Dinothenarus_badipes",           "abondance",                  1,                                                  NA,
  "insectes_sol", "137_144_F01",          "2019-07-03",          "2019-07-26",      "2019-07-26",                  TRUE,   "MP-166",   50.20906,   -66.6765,  "2019-0078",                                     "Sandra_Coulombe,Andre_Anne_Tremblay,Annie_Hibbert",             "classe",            NA,                      "Insecta",                      "Insecta",           "abondance",                  1,                                                  NA,
  "insectes_sol", "137_144_F01",          "2019-06-12",          "2019-07-03",      "2019-07-03",                  TRUE,   "MP-168",   50.20906,  -66.67619,  "2019-0071",                                     "Sandra_Coulombe,Andre_Anne_Tremblay,Annie_Hibbert",             "espèce",            NA,         "Centromerus_furcatus",         "Centromerus_furcatus",           "abondance",                  3,                                                  NA,
  "insectes_sol", "139_103_F01",          "2017-05-23",          "2017-06-15",      "2017-06-15",                  TRUE,    "MP-14",   46.25037,  -71.94965,  "2017-0027",                      "Caroline_Dube,Jean_Michel_Beland,Victor_Renaud,Georges_Pelletier",             "espèce",            NA,            "Hylobius_congener",            "Hylobius_congener",           "abondance",                  3,                                                  NA,
  "insectes_sol", "139_103_F01",          "2017-05-23",          "2017-06-15",      "2017-06-15",                  TRUE,    "MP-11",    46.2503,  -71.94985,  "2017-0026",                                        "Caroline_Dube,Jean_Michel_Beland,Victor_Renaud",             "espèce",            NA,            "Amerizus_wingatei",            "Amerizus_wingatei",           "abondance",                  1,                                                  NA,
  "insectes_sol", "139_111_F01",          "2019-06-25",          "2019-07-25",      "2019-07-25",                  TRUE,     "BP-7",   47.17851,  -70.81454,       "BP-7",                                                                         "Victor_Renaud",             "espèce",            NA,   "Pterostichus_pensylvanicus",   "Pterostichus_pensylvanicus",           "abondance",                  3, "Les coordonnées sont celles de la borne centrale.",
  "insectes_sol", "139_111_F01",          "2019-06-25",          "2019-07-25",      "2019-07-25",                  TRUE,     "BP-1",   47.17851,  -70.81454,       "BP-1",                                                                         "Victor_Renaud",             "espèce",            NA,         "Synuchus_impunctatus",         "Synuchus_impunctatus",           "abondance",                  3, "Les coordonnées sont celles de la borne centrale.",
  "insectes_sol",  "139_87_F01",          "2018-05-24",          "2018-06-20",      "2018-06-20",                  TRUE,    "MP-08",   45.03302,  -73.78268,  "2018-0110",                                         "Lucie_Veilleux,Nathalie_Tessier,Victor_Renaud",             "espèce",            NA,       "Pterostichus_coracinus",       "Pterostichus_coracinus",           "abondance",                  1,                                                  NA,
  "insectes_sol",  "139_87_F01",          "2018-05-24",          "2018-06-20",      "2018-06-20",                  TRUE,    "MP-03",   45.03289,   -73.7825,  "2018-0111",                                                       "Lucie_Veilleux,Nathalie_Tessier",             "classe",            NA,                      "Insecta",                      "Insecta",           "abondance",                  3,                                             "larve",
  "insectes_sol", "141_108_F01",          "2016-05-20",          "2016-06-20",      "2016-06-20",                  TRUE,    "MP-09",   46.78216,  -71.03677,  "2016-0020",                    "Caroline_Dube,Pierre_Alexis_Drolet,Annie_Hibbert,Georges_Pelletier",             "espèce",            NA,   "Pterostichus_pensylvanicus",   "Pterostichus_pensylvanicus",           "abondance",                  1,                                                  NA,
  "insectes_sol", "141_108_F01",          "2016-05-20",          "2016-06-20",      "2016-06-20",                  TRUE,    "MP-09",   46.78216,  -71.03677,  "2016-0020", "Caroline_Dube,Pierre_Alexis_Drolet,Jean_Michel_Beland,Victor_Renaud,Georges_Pelletier",             "espèce",            NA,       "Barypeithes_pellucidus",       "Barypeithes_pellucidus",           "abondance",                 35,                                                  NA,
  "insectes_sol", "141_124_F01",          "2020-05-29",          "2020-06-23",      "2020-06-23",                  TRUE,   "MP-135",    48.1332,   -68.8996,  "2020-0003",                                                          "Jasmin_Michaud,Annie_Hibbert",              "ordre",            NA,                   "Coleoptera",                   "Coleoptera",           "abondance",                  1,                                                  NA,
  "insectes_sol", "141_124_F01",          "2020-06-23",          "2020-07-22",      "2020-07-22",                  TRUE,   "MP-137",   48.13308,   -68.8994,  "2020-0013",                                                          "Jasmin_Michaud,Annie_Hibbert",             "classe",            NA,                   "Gastropoda",                   "Gastropoda",           "abondance",                 11,                                                  NA,
  "insectes_sol", "142_111_F01",          "2017-05-23",          "2017-06-14",      "2017-06-14",                  TRUE,    "MP-10",   46.71114,  -70.70351,  "2017-0015",                                                                         "Caroline_Dube",              "ordre",            NA,                      "Diptera",                      "Diptera",           "abondance",                  9,                                                  NA,
  "insectes_sol", "142_111_F01",          "2019-06-26",          "2019-07-26",      "2019-07-26",                  TRUE,     "MM-2",   46.71124,  -70.70345,       "MM-2",                                                                       "Jessica_Turgeon",             "espèce",            NA,            "Neoantistea_magna",            "Neoantistea_magna",           "abondance",                  1, "Les coordonnées sont celles de la borne centrale.",
  "insectes_sol",  "142_91_F01",          "2019-05-24",          "2019-06-12",      "2019-06-12",                  TRUE,    "MP-02",   45.02204,  -73.06132,  "2019-0114",                                         "Nathalie_Tessier,Lucie_Veilleux,Annie_Hibbert",            "famille",            NA,                 "Phalangiidae",                 "Phalangiidae",           "abondance",                  1,                                                  NA,
  "insectes_sol",  "142_91_F01",          "2019-06-12",          "2019-07-08",      "2019-07-08",                  TRUE,    "MP-02",   45.02204,  -73.06132,  "2019-0122",                                         "Nathalie_Tessier,Lucie_Veilleux,Annie_Hibbert",            "famille",            NA,                 "Phalangiidae",                 "Phalangiidae",           "abondance",                 15,                                                  NA,
  "insectes_sol", "145_102_F01",          "2017-06-08",          "2017-06-29",      "2017-06-29",                  TRUE,    "MP-01",   45.85896,  -71.18786,  "2017-0004",                        "Caroline_Dube,Stephane_Poulin,Jean_Michel_Beland,Victor_Renaud",              "ordre",            NA,                   "Orthoptera",                   "Orthoptera",           "abondance",                  1,                                                  NA,
  "insectes_sol", "145_102_F01",          "2017-06-08",          "2017-06-29",      "2017-06-29",                  TRUE,    "MP-03",   45.85904,  -71.18797,  "2017-0006",                        "Caroline_Dube,Stephane_Poulin,Jean_Michel_Beland,Victor_Renaud",              "ordre",            NA,                   "Orthoptera",                   "Orthoptera",           "abondance",                  1,                                                  NA,
  "insectes_sol", "145_141_F01",          "2018-07-03",          "2018-07-31",      "2018-07-31",                  TRUE,    "MP-48",   48.93657,  -66.04984,  "2018-0074",                                                                                      NA,             "classe",            NA,                   "Collembola",                   "Collembola",           "abondance",                 22,                                                  NA,
  "insectes_sol", "145_141_F01",          "2018-07-31",          "2018-08-29",      "2018-08-29",                  TRUE,    "MP-74",   48.93671,  -66.04989,  "2018-0085",                                                                                      NA,              "ordre",            NA,                      "Diptera",                      "Diptera",           "abondance",                  3,                                                  NA,
  "insectes_sol", "146_133_F01",          "2019-06-20",          "2019-07-18",      "2019-07-18",                  TRUE,   "MP-138",   48.36157,   -67.0137,  "2019-0054",                                                          "Jasmin_Michaud,Annie_Hibbert",             "espèce",            NA,       "Pterostichus_coracinus",       "Pterostichus_coracinus",           "abondance",                  1,                                                  NA,
  "insectes_sol", "146_133_F01",          "2019-06-20",          "2019-07-18",      "2019-07-18",                  TRUE,   "MP-139",   48.36147,  -67.01375,  "2019-0055",                                                          "Jasmin_Michaud,Annie_Hibbert",             "espèce",            NA,      "Pterostichus_adstrictus",      "Pterostichus_adstrictus",           "abondance",                  2,                                                  NA,
  "insectes_sol", "148_101_F01",          "2016-06-20",          "2016-07-20",      "2016-07-20",                  TRUE,    "MP-10",   46.67233,  -71.02971,  "2016-0022", "Caroline_Dube,Pierre_Alexis_Drolet,Jean_Michel_Beland,Victor_Renaud,Georges_Pelletier",             "espèce",            NA,     "Glischrochilus_fasciatus",     "Glischrochilus_fasciatus",           "abondance",                  1,                                                  NA,
  "insectes_sol", "148_101_F01",          "2016-06-21",          "2016-07-21",      "2016-07-21",                  TRUE,    "MP-04",   45.45986,  -71.00023,  "2016-0004",                                                    "Caroline_Dube,Pierre_Alexis_Drolet",              "ordre",            NA,                   "Orthoptera",                   "Orthoptera",           "abondance",                  4,                                                  NA,
  "insectes_sol", "149_142_F01",          "2019-07-22",          "2019-08-13",      "2019-08-13",                  TRUE,    "MP-80",   48.98743,  -65.49979,  "2019-0047",                                                          "Gabriel_Chabot,Annie_Hibbert",             "espèce",            NA,           "Alopecosa_aculeata",           "Alopecosa_aculeata",           "abondance",                  1,                                                  NA,
  "insectes_sol", "149_142_F01",          "2019-06-20",          "2019-07-22",      "2019-07-22",                  TRUE,    "MP-69",   48.98761,  -65.50002,  "2019-0036",                                                          "Gabriel_Chabot,Annie_Hibbert",             "espèce",            NA,           "Callobius_bennetti",           "Callobius_bennetti",           "abondance",                  1,                                                  NA,
  "insectes_sol", "152_138_F01",          "2020-06-17",          "2020-07-14",      "2020-07-14",                  TRUE,    "MP-74",   48.13675,  -65.34921,  "2020-0120",                                              "Gabriel_Chabot,Shany_Houde,Annie_Hibbert",             "espèce",            NA,            "Euryopis_argentea",            "Euryopis_argentea",           "abondance",                  1,                                                  NA,
  "insectes_sol", "152_138_F01",          "2020-07-14",          "2020-08-14",      "2020-08-14",                  TRUE,    "MP-74",   48.13675,  -65.34921,  "2020-0128",                                              "Gabriel_Chabot,Shany_Houde,Annie_Hibbert",              "ordre",            NA,                    "Hemiptera",                    "Hemiptera",           "abondance",                  1,                                                  NA,
  "insectes_sol",  "48_181_T01",          "2017-07-13",          "2017-07-28",      "2017-07-28",                  TRUE,    "MP-29",  62.201777, -75.639472,  "2017-0039",                                                                         "Samuel_Gagnon",             "classe",            NA,                      "Insecta",                      "Insecta",           "abondance",                  3,                                                  NA,
  "insectes_sol",  "48_181_T01",          "2017-07-13",          "2017-07-28",      "2017-07-28",                  TRUE,    "MP-23", 62.2018055, -75.639333,  "2017-0038",                                                                         "Samuel_Gagnon",              "ordre",            NA,                      "Diptera",                      "Diptera",           "abondance",                 14,                                                  NA,
  "insectes_sol",  "57_156_T01",          "2018-06-28",          "2018-08-01",      "2018-08-01",                  TRUE,    "MP-21",   58.49215,   -78.0879,  "2018-0142",                                            "Caroline_Dube,Anouk_Simard,Jessica_Turgeon",             "espèce",            NA,           "Sciastes_truncatus",           "Sciastes_truncatus",           "abondance",                  1,                                                  NA,
  "insectes_sol",  "57_156_T01",          "2018-06-28",          "2018-08-01",      "2018-08-01",                  TRUE,    "MP-19",   58.49222,  -78.08755,  "2018-0140",                                                            "Caroline_Dube,Anouk_Simard",             "classe",            NA,                      "Insecta",                      "Insecta",           "abondance",                  7,                                                  NA,
  "insectes_sol",  "57_182_T01",          "2019-07-02",          "2019-08-03",      "2019-08-03",                  TRUE,   "MP-104",   61.31266,  -73.66673,  "2019-0247",                                                                         "Annie_Hibbert",              "ordre",            NA,                    "Hemiptera",                    "Hemiptera",           "abondance",                  3,                                                  NA,
  "insectes_sol",  "57_182_T01",          "2019-08-03",          "2019-09-09",      "2019-09-09",                  TRUE,    "MP-93",   61.31284,  -73.66683,  "2019-0252",                                                                         "Annie_Hibbert",              "ordre",            NA,                      "Diptera",                      "Diptera",           "abondance",                 19,                                                  NA,
  "insectes_sol",  "73_137_F02",          "2019-06-20",          "2019-07-26",      "2019-07-26",                  TRUE,    "MP-87",   55.29344,  -77.69216,  "2019-0230",                                        "Stephanie_Arnold,Kevin_Montreuil,Annie_Hibbert",            "famille",            NA,                   "Formicidae",                   "Formicidae",           "abondance",                  3,               "Fichier ID non trouvé/Pas identifié",
  "insectes_sol",  "73_137_F02",          "2019-06-20",          "2019-07-26",      "2019-07-26",                  TRUE,    "MP-88",   55.29322,    -77.692,  "2019-0231",                                        "Stephanie_Arnold,Kevin_Montreuil,Annie_Hibbert",             "espèce",            NA,       "Pocadicnemis_americana",       "Pocadicnemis_americana",           "abondance",                  1,                                                  NA,
  "insectes_sol",  "73_137_T01",          "2018-07-21",          "2018-09-21",      "2018-09-21",                  TRUE,    "MP-88",   55.28418,  -77.69357,  "2018-0232",                                        "Chad_Rice,Anne_Sophie_Belanger,Jessica_Turgeon",             "espèce",            NA,             "Gnaphosa_microps",             "Gnaphosa_microps",           "abondance",                  3,                                                  NA,
  "insectes_sol",  "73_137_T01",          "2018-07-21",          "2018-09-21",      "2018-09-21",                  TRUE,    "MP-86",   55.28427,  -77.69378,  "2018-0230",                                                        "Chad_Rice,Anne_Sophie_Belanger",             "classe",            NA,                   "Collembola",                   "Collembola",           "abondance",                  3,                                                  NA,
  "insectes_sol",  "73_137_T03",          "2020-06-24",          "2020-08-09",      "2020-08-09",                  TRUE,    "MP-87",   55.19592,  -77.36316,  "2020-0135",                                 "Patrick_Lacerte,Jessy_Lepine,Yan_Girard,Annie_Hibbert",             "espèce",            NA,       "Diplocentria_bidentata",       "Diplocentria_bidentata",           "abondance",                  2,                                                  NA,
  "insectes_sol",  "73_137_T03",          "2020-06-24",          "2020-08-09",      "2020-08-09",                  TRUE,    "MP-26",   55.19589,  -77.36332,  "2020-0129",                                 "Patrick_Lacerte,Jessy_Lepine,Yan_Girard,Annie_Hibbert",             "classe",            NA,                      "Insecta",                      "Insecta",           "abondance",                  1,                                                  NA,
  "insectes_sol",  "80_175_T01",          "2017-09-02",          "2017-09-15",      "2017-09-15",                  TRUE,    "MP-18",  58.646213, -69.997035,  "2017-0050",                                                                        "Francis_Demers",             "classe",            NA,                      "Insecta",                      "Insecta",           "abondance",                 13,                                                  NA,
  "insectes_sol",  "80_175_T01",          "2017-08-18",          "2017-09-02",      "2017-09-02",                  TRUE,    "MP-18",  58.646213, -69.997035,  "2017-0047",                                                                        "Francis_Demers",             "classe",            NA,                      "Insecta",                      "Insecta",           "abondance",                  2,                                                  NA,
  "insectes_sol",  "86_180_T01",          "2018-06-21",          "2018-07-20",      "2018-07-20",                  TRUE,    "MP-93",   58.05357,  -68.51154,  "2018-0024",                                                         "Caroline_Dube,Jessica_Turgeon",             "espèce",            NA,              "Pardosa_uintana",              "Pardosa_uintana",           "abondance",                  1,                                                  NA,
  "insectes_sol",  "86_180_T01",          "2018-07-20",          "2018-08-16",      "2018-08-16",                  TRUE,    "MP-95",   58.05352,  -68.51183,  "2018-0031",                                                                         "Caroline_Dube",              "ordre",            NA,                      "Diptera",                      "Diptera",           "abondance",                 35,                                                  NA,
  "insectes_sol",  "86_180_T02",          "2019-06-15",          "2019-09-02",      "2019-09-02",                  TRUE,    "MP-98",   58.20939,   -68.3733,  "2019-0026",                                                            "Anouk_Simard,Annie_Hibbert",        "sous-classe",            NA,                      "Acarina",                      "Acarina",           "abondance",                  2,                                                  NA,
  "insectes_sol",  "86_180_T02",          "2019-06-15",          "2019-09-02",      "2019-09-02",                  TRUE,   "MP-102",   58.20941,  -68.37347,  "2019-0023",                                                           "Caroline_Dube,Annie_Hibbert",             "classe",            NA,                      "Insecta",                      "Insecta",           "abondance",                  2,                                                  NA,
  "insectes_sol",  "90_189_T01",          "2019-06-17",          "2019-07-14",      "2019-07-14",                  TRUE,   "MP-177",   58.72501,  -66.00292,  "2019-0208",                                                                         "Annie_Hibbert",             "classe",            NA,                      "Insecta",                      "Insecta",           "abondance",                  1,                                             "larve",
  "insectes_sol",  "90_189_T01",          "2019-07-14",          "2019-09-10",      "2019-09-10",                  TRUE,   "MP-183",   58.72499,  -66.00282,  "2019-0219",                                                                         "Annie_Hibbert",             "classe",            NA,                   "Collembola",                   "Collembola",           "abondance",                  3,                                                  NA,
  "insectes_sol",  "94_192_T01",          "2018-06-24",          "2018-07-25",      "2018-07-25",                  TRUE,   "MP-101",   58.61036,  -64.53053,  "2018-0045",                                                         "Caroline_Dube,Jessica_Turgeon",             "espèce",            NA,           "Scotinotylus_sacer",           "Scotinotylus_sacer",           "abondance",                  1,                                                  NA,
  "insectes_sol",  "94_192_T01",          "2018-06-24",          "2018-07-25",      "2018-07-25",                  TRUE,    "MP-98",    58.6102,  -64.53017,  "2018-0044",                                                         "Caroline_Dube,Jessica_Turgeon",             "espèce",            NA,           "Sciastes_truncatus",           "Sciastes_truncatus",           "abondance",                  6,                                                  NA,
  "insectes_sol",   "97_90_F01",          "2020-06-08",          "2020-06-29",      "2020-06-29",                  TRUE,   "MP-198",   48.43655,  -79.42762,  "2020-0066",                                          "Isabelle_Dumais,Alexane_Gaudet,Annie_Hibbert",             "classe",            NA,                   "Collembola",                   "Collembola",           "abondance",                  9,                                                  NA,
  "insectes_sol",   "97_90_F01",          "2020-06-29",          "2020-07-20",      "2020-07-20",                  TRUE,   "MP-211",   48.43652,  -79.42765,  "2020-0075",                                          "Isabelle_Dumais,Alexane_Gaudet,Annie_Hibbert",            "famille",            NA,                   "Formicidae",                   "Formicidae",           "abondance",                  2,               "Fichier ID non trouvé/Pas identifié",
  "insectes_sol",   "99_88_F01",          "2019-07-12",          "2019-08-12",      "2019-08-12",                  TRUE,   "MP-215",   48.14549,  -79.27856,  "2019-0015",                                      "Isabelle_Dumais,Savannah_Bussieres,Annie_Hibbert",             "classe",            NA,                      "Insecta",                      "Insecta",           "abondance",                  1,                                                  NA,
  "insectes_sol",   "99_88_F01",          "2019-06-18",          "2019-07-12",      "2019-07-12",                  TRUE,   "MP-170",   48.14534,  -79.27858,  "2019-0001",                                      "Isabelle_Dumais,Savannah_Bussieres,Annie_Hibbert",             "espèce",            NA,            "Clubiona_johnsoni",            "Clubiona_johnsoni",           "abondance",                  1,                                                  NA
  )

  
```


Here is a demo dataset that we will use


```{r}
knitr::kable(head(insect_demo))
```

first we prepare it 

```{r}
insect_demo_site_prep <- rcoleo::coleo_prep_input_data(insect_demo, db_table = "sites")
```

Data preparation nests all the data which is not needed for injection into a particular table.
Here we are injecting data into the site table. these present data contain only the site_code.


```{r}

suppressPackageStartupMessages(library(tidyverse))
library(rcoleo)

site_id_results <- insect_demo_site_prep |> 
  mutate(site_id = coleo_get_site_id(site_code))

head(site_id_results)

site_id_results |> 

```


the result is a dataframe with a column for site_id

This column has `NA_integer_` where the site needs to be injected.



### Workflow

* validate the whole dataset
* prepare the data for one table
* request IDs from the database
* if and only if the ID is absent, create a request to inject it (in a list col)
* check that these are formatted correctly by printing a few
* if and only if the ID is absent, inject that record, return response
* extract the ID code from that response
* combine ID codes from injection with those already there. Rename any columns. drop old columns. unnest the data nested in "prepare the data".









```{r, include=FALSE}
end_vignette()
```

