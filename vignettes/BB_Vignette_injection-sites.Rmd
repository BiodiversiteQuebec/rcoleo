---
output: html_document
---

```r


#### On garde une ligne par site
site_df <- site_df[!duplicated(site_df),]

#### Récupération des `cell_id`
site_df <- dplyr::left_join(site_df, cells[, c("id", "cell_code")], by = "cell_code")
names(site_df)[names(site_df) == "id"] <- "cell_id"

#### création de la variable geom
site_df_ls <- apply(site_df, 1, as.list) # Création de la liste
str(site_df_ls) # Vérification de la structure de l'objet

# Creer geom points
geom <- apply(site_df,1, function(x){
  if(!any(is.na(x["lat"]), is.na(x["lon"]))){
    return(geojsonio::geojson_list(as.numeric(c(x["lon"], x["lat"])))$features[[1]]$geometry)
  } else {
    return(NA)
  }})

crs_ls <- list(type="name",properties=list(name="EPSG:4326"))

# Fusionner les deux listes (geomations + sites)
for(i in 1:length(site_df_ls)){
  site_df_ls[[i]]$geom <- geom[i][[1]]
  if(is.list(site_df_ls[[i]]$geom)){
    site_df_ls[[i]]$geom$crs <- list(type = "name",
                                     properties = list(name="EPSG:4326"))
  }
}

site_df_ls

#### Injection des nouveaux sites
inj_sites <- rcoleo::post_sites(site_df_ls)

```
